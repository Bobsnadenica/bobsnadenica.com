<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Level 25: API Server | Tech Knowledge Hub</title>
  <style>
    :root {
      --bg-body: #0a0d12;
      --bg-surface: #161b22;
      --bg-card: #0d1117;
      --border-subtle: rgba(240, 246, 252, 0.1);
      --border-hover: rgba(56, 139, 253, 0.4);
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      
      --accent-server: #3fb950;   /* Node.js Green */
      --accent-mid: #d29922;      /* Middleware Gold */
      --accent-db: #0db7ed;       /* DB Blue */
      --accent-block: #ff7b72;    /* Red for Blocked */
      
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--bg-body);
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(63, 185, 80, 0.08), transparent 25%),
        radial-gradient(circle at 90% 80%, rgba(210, 153, 34, 0.05), transparent 25%);
      color: var(--text-primary);
      font-family: var(--font-sans);
      line-height: 1.6;
      padding-bottom: 4rem;
    }

    a { text-decoration: none; color: inherit; }

    /* LAYOUT */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }

    /* HEADER */
    header { padding: 3rem 0; border-bottom: 1px solid var(--border-subtle); margin-bottom: 3rem; }
    .breadcrumb { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; }
    .breadcrumb a:hover { color: var(--accent-server); }
    
    h1 {
      font-size: 3rem; font-weight: 800; letter-spacing: -0.03em; margin-bottom: 1rem;
      background: linear-gradient(90deg, #fff, var(--accent-server));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .intro { font-size: 1.25rem; color: var(--text-secondary); max-width: 700px; }

    /* CARDS */
    .section-title { 
      font-size: 1.75rem; margin: 4rem 0 1.5rem; color: var(--text-primary); 
      display: flex; align-items: center; gap: 12px;
      border-left: 4px solid var(--accent-server);
      padding-left: 1rem;
    }

    .concept-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }

    .card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: 12px; padding: 1.5rem;
      transition: transform 0.2s; position: relative; overflow: hidden;
    }
    .card:hover { transform: translateY(-2px); }
    .card h3 { margin-bottom: 0.5rem; font-size: 1.1rem; }
    .card p { color: var(--text-secondary); font-size: 0.95rem; }

    /* PIPELINE SIMULATOR */
    .server-console {
      background: #0d1117; border: 1px solid #30363d; border-radius: 12px;
      padding: 2rem; margin: 2rem 0; overflow: hidden;
      display: grid; grid-template-columns: 250px 1fr; gap: 2rem;
    }
    @media (max-width: 900px) { .server-console { grid-template-columns: 1fr; } }

    /* LEFT: CODE CONFIG */
    .config-pane {
      background: #161b22; border: 1px solid #30363d; border-radius: 8px;
      padding: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem;
    }
    .pane-title { font-weight: bold; color: #8b949e; text-transform: uppercase; font-size: 0.8rem; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
    
    .switch-row {
      display: flex; justify-content: space-between; align-items: center;
      background: #0d1117; padding: 10px; border-radius: 6px; border: 1px solid #30363d;
    }
    .switch-label { font-size: 0.9rem; font-weight: bold; }
    .switch-desc { font-size: 0.7rem; color: #8b949e; }
    
    .toggle {
      position: relative; width: 40px; height: 20px;
    }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #30363d; transition: .4s; border-radius: 20px;
    }
    .slider:before {
      position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px;
      background-color: white; transition: .4s; border-radius: 50%;
    }
    input:checked + .slider { background-color: var(--accent-server); }
    input:checked + .slider:before { transform: translateX(20px); }

    .code-preview {
      font-family: var(--font-mono); font-size: 0.75rem; color: #a5d6ff;
      background: #000; padding: 10px; border-radius: 6px; border: 1px solid #30363d;
      min-height: 100px; white-space: pre; opacity: 0.8;
    }

    /* RIGHT: VISUAL PIPELINE */
    .pipeline-stage {
      background: #010409; border: 1px solid #30363d; border-radius: 12px;
      padding: 2rem; position: relative; min-height: 350px;
      display: flex; align-items: center; justify-content: space-between;
    }
    
    .pipe-section {
      width: 15%; height: 60px; border: 2px dashed #30363d; border-radius: 8px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      position: relative; font-size: 0.8rem; font-weight: bold; color: #8b949e;
      transition: all 0.3s;
    }
    .pipe-section.active { border-color: var(--accent-mid); color: #fff; background: rgba(210, 153, 34, 0.1); }
    
    .pipe-connector { flex-grow: 1; height: 4px; background: #30363d; margin: 0 5px; }
    
    /* ENDPOINTS */
    .endpoint-start { width: 60px; height: 60px; border-radius: 50%; background: #21262d; border: 2px solid #fff; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; z-index: 5; }
    .endpoint-end { 
      width: 80px; height: 80px; border-radius: 8px; background: #161b22; 
      border: 2px solid var(--accent-db); display: flex; flex-direction: column; 
      align-items: center; justify-content: center; z-index: 5;
    }

    /* PACKETS */
    .req-packet {
      position: absolute; width: 30px; height: 30px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 1rem;
      background: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.2); z-index: 10;
      left: 60px; opacity: 0;
    }
    .req-user { border: 2px solid var(--accent-server); color: #000; }
    .req-hacker { border: 2px solid var(--accent-block); background: #3d1f1f; color: #fff; }

    /* LOGS */
    .server-log {
      grid-column: span 2; background: #000; border: 1px solid #30363d; border-radius: 6px;
      padding: 10px; font-family: var(--font-mono); font-size: 0.8rem; color: #8b949e;
      height: 100px; overflow-y: auto;
    }
    .log-success { color: var(--accent-server); }
    .log-error { color: var(--accent-block); }
    .log-info { color: #a5d6ff; }

  </style>
</head>
<body>

  <div class="container">
    <header>
      <div class="breadcrumb"><a href="index.html">‚Üê Back to Hub</a> / Development & OS</div>
      <h1>API Server (Backend)</h1>
      <p class="intro">
        If the REST API is the menu, the <strong>API Server</strong> is the Chef. 
        It is a program (usually running 24/7) that listens for incoming requests, runs logic, connects to the database, and sends a response.
      </p>
    </header>

    <h2 class="section-title">üèóÔ∏è Anatomy of a Server</h2>
    <div class="concept-grid">
      <div class="card" style="border-top: 4px solid var(--accent-server);">
        <h3>1. The Listener</h3>
        <p>The server binds to a <strong>Port</strong> (like 3000 or 8080) and waits forever. It's like a receptionist sitting at the desk waiting for the phone to ring.</p>
      </div>
      <div class="card" style="border-top: 4px solid var(--accent-mid);">
        <h3>2. Middleware</h3>
        <p>The security guards. Before the request reaches the main logic, it passes through layers: Logging, Authentication, Body Parsing, Rate Limiting.</p>
      </div>
      <div class="card" style="border-top: 4px solid var(--accent-db);">
        <h3>3. The Controller</h3>
        <p>The brain. Once the request passes the guards, the Controller decides what to do (e.g., "Find user ID 5 in DB") and sends the JSON response.</p>
      </div>
    </div>

    <h2 class="section-title">üïπÔ∏è The Middleware Gauntlet</h2>
    <p style="margin-bottom: 1rem; color: var(--text-secondary);">
      <strong>Mission:</strong> Configure your Express.js server stack.
      <br>Enable the right Middleware to stop the <strong>Hacker (üëæ)</strong> while letting the <strong>User (üë§)</strong> access the database.
    </p>

    <div class="server-console">
      
      <div class="config-pane">
        <div class="pane-title">Server Configuration</div>
        
        <div class="switch-row">
          <div>
            <div class="switch-label">Auth Middleware</div>
            <div class="switch-desc">Verify API Key / Token</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="swAuth" onchange="updateCode()">
            <span class="slider"></span>
          </label>
        </div>

        <div class="switch-row">
          <div>
            <div class="switch-label">Rate Limiter</div>
            <div class="switch-desc">Block spamming IPs</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="swRate" onchange="updateCode()">
            <span class="slider"></span>
          </label>
        </div>

        <div class="code-preview" id="codeBlock">
const app = express();

// Middleware Stack
// ...

app.get('/data', (req, res) => {
  db.findData();
});
        </div>
      </div>

      <div class="pipeline-stage">
        
        <div class="endpoint-start">üåê</div>
        
        <div class="pipe-connector"></div>
        
        <div class="pipe-section" id="stageRate">
          <div>‚è±Ô∏è</div>
          <div>Rate Limit</div>
        </div>

        <div class="pipe-connector"></div>

        <div class="pipe-section" id="stageAuth">
          <div>üîê</div>
          <div>Auth</div>
        </div>

        <div class="pipe-connector"></div>

        <div class="pipe-section active" style="border-style:solid; border-color:var(--accent-server);">
          <div>üß†</div>
          <div>Logic</div>
        </div>

        <div class="pipe-connector"></div>

        <div class="endpoint-end">
          <div style="font-size:1.5rem;">üóÑÔ∏è</div>
          <div style="font-size:0.7rem; font-weight:bold; color:var(--accent-db);">DB</div>
        </div>

      </div>

      <div class="server-log" id="srvLog">
        <div>> Server listening on port 3000...</div>
      </div>

    </div>

  </div>

  <script>
    const codeBlock = document.getElementById('codeBlock');
    const srvLog = document.getElementById('srvLog');
    
    const stageAuth = document.getElementById('stageAuth');
    const stageRate = document.getElementById('stageRate');
    
    let authEnabled = false;
    let rateEnabled = false;

    function updateCode() {
      authEnabled = document.getElementById('swAuth').checked;
      rateEnabled = document.getElementById('swRate').checked;
      
      // Update Visuals
      stageAuth.className = authEnabled ? 'pipe-section active' : 'pipe-section';
      stageRate.className = rateEnabled ? 'pipe-section active' : 'pipe-section';

      // Update Code Snippet
      let code = `const app = express();\n\n`;
      if (rateEnabled) code += `app.use(rateLimiter()); // Stop spam\n`;
      if (authEnabled) code += `app.use(authCheck());   // Check token\n`;
      code += `\napp.get('/data', (req, res) => {\n  db.findData(); // Business Logic\n});`;
      
      codeBlock.innerText = code;
    }

    function log(msg, type) {
      const div = document.createElement('div');
      div.innerText = `> ${msg}`;
      if (type === 'success') div.className = 'log-success';
      if (type === 'error') div.className = 'log-error';
      if (type === 'info') div.className = 'log-info';
      srvLog.prepend(div);
    }

    // TRAFFIC SIMULATOR LOOP
    setInterval(() => {
      spawnPacket();
    }, 2500);

    function spawnPacket() {
      // Random Packet Type
      const rand = Math.random();
      let type = 'user'; // Normal user
      if (rand > 0.6) type = 'hacker'; // Invalid Token
      if (rand > 0.8) type = 'spammer'; // Too fast
      
      const p = document.createElement('div');
      p.className = `req-packet ${type === 'user' ? 'req-user' : 'req-hacker'}`;
      p.innerHTML = type === 'user' ? 'üë§' : (type === 'hacker' ? 'üëæ' : 'ü§ñ');
      
      // Start position (left of pipeline)
      const container = document.querySelector('.pipeline-stage');
      container.appendChild(p);
      
      // Initial state
      p.style.left = '60px';
      p.style.opacity = '1';

      // --- ANIMATION SEQUENCE ---
      
      // 1. Move to Rate Limit
      setTimeout(() => {
        p.style.transition = 'left 0.5s linear';
        p.style.left = '25%'; // Approx pos of Rate Limit
        
        setTimeout(() => {
          // CHECK RATE LIMIT
          if (type === 'spammer') {
             if (rateEnabled) {
               blockPacket(p, "429 Too Many Requests");
               return;
             } else {
               log("‚ö†Ô∏è High traffic load detected! (Enable Rate Limiter)", "info");
             }
          }

          // 2. Move to Auth
          p.style.left = '50%'; // Approx pos of Auth
          
          setTimeout(() => {
            // CHECK AUTH
            if (type === 'hacker') {
              if (authEnabled) {
                blockPacket(p, "401 Unauthorized (Invalid Token)");
                return;
              } else {
                // Hacker passes!
                log("üö® SECURITY ALERT: Hacker accessed Database!", "error");
              }
            }

            // 3. Move to DB (Success)
            p.style.left = '90%';
            p.style.backgroundColor = '#2ea043';
            
            setTimeout(() => {
              p.style.opacity = '0';
              if (type === 'user') log("200 OK: Data sent to user.", "success");
              setTimeout(() => p.remove(), 500);
            }, 500);

          }, 600);
        }, 600);
      }, 100);
    }

    function blockPacket(el, reason) {
      el.style.backgroundColor = '#ff7b72';
      el.style.transform = 'translateY(20px)';
      el.innerHTML = 'üö´';
      setTimeout(() => {
        el.style.opacity = '0';
        log(`Blocked: ${reason}`, "error");
        setTimeout(() => el.remove(), 500);
      }, 500);
    }
    
    // Init
    updateCode();

  </script>

</body>
</html>