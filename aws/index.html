<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AWS Console (Simulation)</title>
  <meta name="description" content="Lightweight AWS Config and CloudTrail script simulator for quick insights and mock testing.">
  <style>
:root {
  --bg: #0b0d10;
  --panel: #111418;
  --panel-2: #161b22;
  --text: #e6edf3;
  --muted: #9aa4af;
  --accent: #ff9900; /* AWS orange */
  --border: #222831;
  --good: #22c55e;
  --warn: #eab308;
  --bad: #ef4444;
  --code: #0d1117;
}

* { box-sizing: border-box; }
html {
  scroll-behavior: smooth;
}
html, body { height: 100%; }

body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background: var(--bg);
  color: var(--text);
  display: grid;
  grid-template-rows: 56px 1fr;
  overflow-y: hidden;
  overflow-x: hidden;
}

/* Top bar */
header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 16px;
  background: linear-gradient(180deg, #0e131a, #0a0e13);
  border-bottom: 1px solid var(--border);
}
.logo { font-weight: 700; letter-spacing: .2px; }
.badge {
  font-size: 12px;
  color: #111;
  background: var(--accent);
  padding: 2px 6px;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.spacer { flex: 1; }
.top-actions button { margin-left: 8px; }

/* Layout */
main { display: grid; grid-template-columns: 280px 1fr; min-height: 100%; }
aside {
  background: var(--panel);
  border-right: 1px solid var(--border);
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* prevent double scrollbars; let #script-list scroll */
  padding: 12px;
  box-shadow: inset -1px 0 0 var(--border);
}
.section-title {
  font-size: 12px;
  color: var(--accent);
  font-weight: 700;
  margin: 16px 8px 8px;
  text-transform: uppercase;
  letter-spacing: .08em;
  border-bottom: 1px solid var(--border);
  padding-bottom: 4px;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.section-title:hover {
  color: #ffd580;
}

/* Make the script list the only scrollable area in the sidebar */
#script-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  flex: 1 1 auto;
  min-height: 0;               /* critical for flex children to allow scrolling */
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 4px;          /* room for custom scrollbar */
  max-height: calc(100vh - 56px); /* header height offset */
}
.nav-btn {
  width: 100%;
  text-align: left;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text);
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.nav-btn:hover { background: var(--panel-2); border-color: var(--border); }
.nav-btn.active {
  background: var(--panel-2);
  border-color: var(--accent);
  color: var(--accent);
}
pre { line-height: 1.45; }

.saved-list {
  margin: 8px 0;
  display: grid;
  gap: 6px;
}
.saved-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--panel-2);
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
.saved-item-name {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.icon-btn {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted);
  padding: 4px 8px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.icon-btn:hover {
  color: var(--text);
  border-color: var(--text);
}

/* Workbench */
.workbench {
  display: grid;
  grid-template-rows: auto 1fr auto;
  height: 100%;
}
.toolbar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
  background: var(--panel);
}
.toolbar .title { font-weight: 600; }

.editor-area {
  display: grid;
  grid-template-columns: 1fr 40%;
  gap: 12px;
  padding: 12px;
  height: 100%;
  background: var(--panel);
  border-bottom: 1px solid var(--border);
}
.card {
  display: grid;
  grid-template-rows: auto 1fr;
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  background: var(--panel-2);
  position: relative; /* ensure the button stays pinned inside */
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
.card h3 {
  margin: 0;
  padding: 10px 12px;
  font-size: 13px;
  border-bottom: 1px solid var(--border);
  background: #0f1420;
}

textarea {
  width: 100%;
  height: 100%;
  resize: none;
  padding: 12px;
  border: 0;
  outline: none;
  background: var(--code);
  color: #d1d9e0;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 13px;
  line-height: 1.5;
}

pre {
  margin: 0;
  padding: 12px;
  background: var(--code);
  color: #d1d9e0;
  overflow: auto;
}

#output {
  display: inline-block;
  min-width: max-content; /* keep columns/tables intact; enable horizontal scroll */
  background: transparent;
  color: inherit;
  padding: 0;
  margin: 0;
}

.controls { display: flex; align-items: center; gap: 8px; }
.btn {
  border: 1px solid var(--border);
  background: #0f1420;
  color: var(--text);
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.btn.primary {
  background: var(--accent);
  color: #111;
  border-color: #d97f00;
  font-weight: 700;
}
.btn.ghost { background: transparent; }
.btn:disabled { opacity: .6; cursor: not-allowed; }

.statusbar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: #0e141f;
  color: var(--muted);
  font-size: 12px;
}
.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--warn);
  display: inline-block;
}
.status--ok { color: var(--muted); }
.status--warn { color: var(--warn); }
.status--error { color: var(--bad); }
.kbd {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";
  border: 1px solid var(--border);
  padding: 2px 6px;
  border-radius: 6px;
  background: #0e141f;
  color: var(--muted);
}

@media (max-width: 1100px) {
  .editor-area { grid-template-columns: 1fr; }
}


#output-container {
  max-height: 70vh;
  min-height: 160px;
  max-width: 100%;
  overflow-x: auto;
  overflow-y: auto;
  white-space: pre; /* preserve structure */
  word-break: normal; /* don’t break words mid-line */
  background: var(--code);
  color: #d1d9e0;
  padding: 12px;
  border-radius: 8px;
  resize: vertical; /* only allow up/down resize */
  box-sizing: border-box; /* keep padding inside bounds */
}

#output-container:focus {
  outline: 2px solid var(--accent);
}

/* Fullscreen output mode */
#output-container.fullscreen {
  position: fixed;
  z-index: 1000;
  top: 56px; /* header height */
  left: 0;
  right: 0;
  bottom: 0;
  width: 100vw;
  height: calc(100vh - 56px);
  max-height: none;
  border-radius: 0;
  margin: 0;
  resize: none; /* disable manual resize in fullscreen */
}
body.no-scroll { overflow: hidden; }

/* Subtle custom scrollbars (WebKit) */
#output-container::-webkit-scrollbar {
  height: 10px;
  width: 10px;
}
#output-container::-webkit-scrollbar-thumb {
  background: #2a3240;
  border-radius: 8px;
}
#output-container::-webkit-scrollbar-track {
  background: #0f1420;
}

/* Firefox scrollbar */
#output-container {
  scrollbar-width: thin;
  scrollbar-color: #2a3240 #0f1420;
}

@media (max-width: 1100px) {
  #output-container { max-height: 65vh; }
}
  #toggle-fullscreen {
    position: absolute;
    top: 10px;
    right: 12px;
    z-index: 10;
    margin: 0;
  }
  </style>
</head>
<body>
  <header>
    <div class="logo">AWS Console</div>
    <span class="badge" tabindex="0" aria-label="Simulation badge">Simulation</span>
    <div class="spacer"></div>
  </header>

  <main>
    <aside>
      <div class="section-title" tabindex="0">Scripts</div>
      <div id="script-list" class="saved-list"></div>
    </aside>

    <section class="workbench">
      <div class="toolbar">
        <div class="title">Script Runner</div>
        <div class="spacer"></div>
        <div class="controls">
          <button id="run-btn" class="btn primary" aria-label="Run script" title="Run script" onclick="runScript()">Run ▷</button>
        </div>
      </div>

      <div class="editor-area">
        <div class="card">
          <h3>Script</h3>
          <pre id="script-view">Select a script from the left…\n</pre>
        </div>
        <div class="card">
          <h3>Output</h3>
          <button id="toggle-fullscreen" class="btn small" style="float:right; margin-bottom:6px;" aria-label="Expand output fullscreen" title="Expand or collapse output" onclick="toggleOutputFullscreen()">Expand ↗︎</button>
          <div id="output-container" tabindex="0">
            <pre id="output" aria-live="polite">Ready. Select a script and click Run.\n</pre>
          </div>
        </div>
      </div>

      <div class="statusbar">
        <span class="status-dot" id="engine-dot" title="Engine status"></span>
        <span id="engine-status" class="status--ok">Ready</span>
        <span class="spacer"></span>
        <span>Tips: Save (<span class="kbd">Ctrl/⌘+S</span>), Run (<span class="kbd">Ctrl/⌘+Enter</span>)</span>
      </div>
    </section>
  </main>

  <!-- removed stray </main> and removed engine.js script tag -->
  <button id="exit-fullscreen" class="btn small" style="display:none; position:fixed; top:12px; right:16px; z-index:1100;" aria-label="Close fullscreen output" title="Close fullscreen output" onclick="toggleOutputFullscreen()">✕ Close</button>
  <script defer>
// Core script execution engine with inline mock response support

function showStatus(msg, kind = 'ok') {
  const el = document.getElementById('engine-status');
  el.textContent = msg;
  el.classList.remove('status--ok', 'status--warn', 'status--error');
  el.classList.add(kind === 'error' ? 'status--error' : kind === 'warn' ? 'status--warn' : 'status--ok');
}

function extractMockResponse(code) {
  const mockStart = code.indexOf("# ---MOCK_RESPONSE---");
  const mockEnd = code.indexOf("# ---END_MOCK---");
  if (mockStart !== -1 && mockEnd !== -1 && mockEnd > mockStart) {
    return code
      .slice(mockStart + "# ---MOCK_RESPONSE---".length, mockEnd)
      .split("\n")
      .map(l => l.replace(/^# ?/, "")) // remove leading #
      .join("\n")
      .trim() + "\n";
  }
  return null;
}

function appendOutput(text) {
  const out = document.getElementById("output");
  out.textContent += text;
  out.scrollTo({ top: out.scrollHeight, behavior: 'smooth' });
}

function clearOutput() {
  document.getElementById("output").textContent = "";
}

async function runScript() {
  showStatus('Running…', 'warn');
  const btn = document.getElementById("run-btn");
  btn.disabled = true;
  btn.textContent = "Running…";
  clearOutput(); // Clear previous output at the start
  try {
    const code = document.getElementById("script-view").textContent || ""; // ✅ fixed
    const lines = code.split(/\r?\n/);
    for (const raw of lines) {
      const line = raw.trim();
      if (!line || line.startsWith("#")) continue;
      appendOutput(`$ ${line}\n`);
      // Fake delay to simulate execution
      await new Promise(r => setTimeout(r, 50));
    }

    // Extract mock from full file if available
    let mock = null;
    if (window.currentScriptFile) {
      try {
        const res = await fetch("./scripts/" + window.currentScriptFile);
        const fullCode = await res.text();
        mock = extractMockResponse(fullCode);
      } catch {
        appendOutput("[!] Could not load full script file for mock output.\n");
      }
    }

    // Fallback to editor content
    if (!mock) {
      mock = extractMockResponse(code);
    }

    if (mock) {
      appendOutput(mock + "\n");
    } else {
      appendOutput("No mock response found in this script.\n");
    }
  } finally {
    btn.disabled = false;
    btn.textContent = "Run ▷";
    document.getElementById("output-container").scrollTop = 0;
    showStatus('Done', 'ok');
  }
}
</script>
  <script defer>
    function toggleOutputFullscreen() {
      const container = document.getElementById('output-container');
      const btn = document.getElementById('toggle-fullscreen');
      const exitBtn = document.getElementById('exit-fullscreen');
      if (!container.classList.contains('fullscreen')) {
        container.classList.add('fullscreen');
        document.body.classList.add('no-scroll');
        btn.textContent = 'Collapse ↙︎';
        exitBtn.style.display = 'block';
      } else {
        container.classList.remove('fullscreen');
        document.body.classList.remove('no-scroll');
        btn.textContent = 'Expand ↗︎';
        exitBtn.style.display = 'none';
      }
    }
  </script>
<script defer>
// Minimal UI for AWS Console Simulation – Only shows scripts and lets you run them

const LAST_SCRIPT_KEY = 'aws-sim:lastScript';

async function loadAvailableScripts() {
  const list = document.getElementById("script-list");
  list.innerHTML = "";
  showStatus('Loading scripts…', 'warn');
  let data = null;

  try {
    const resp = await fetch("./scripts/scripts_index.json");
    data = await resp.json();
    showStatus('Scripts loaded', 'ok');
  } catch {
    data = ["example.sh", "sample.json"];
    showStatus('Using fallback script list', 'warn');
  }

  // If object → categorized scripts
  const categories = typeof data === "object" && !Array.isArray(data) ? data : { "Scripts": data };
  const lastScript = localStorage.getItem(LAST_SCRIPT_KEY);
  let firstButton = null;
  let lastButtonToSelect = null;

  for (const [category, files] of Object.entries(categories)) {
    const header = document.createElement("div");
    header.className = "section-title";
    header.textContent = category;
    list.appendChild(header);

    files.forEach(file => {
      const btn = document.createElement("button");
      btn.className = "nav-btn";
      btn.textContent = file.split("/").pop();
      btn.setAttribute('tabindex', '0');
      btn.onclick = async () => {
        showStatus('Loading script…', 'warn');
        // Remove active from all nav-btns, add to this
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        localStorage.setItem(LAST_SCRIPT_KEY, file);
        document.getElementById('script-view').textContent = 'Loading…';
        document.getElementById('output').textContent = 'Ready. Select a script and click Run.\n';
        window.currentScriptFile = file; // track selected file
        try {
          const res = await fetch("./scripts/" + file);
          let content = await res.text();
          // Strip mock section for cleaner view
          const start = content.indexOf("# ---MOCK_RESPONSE---");
          const end = content.indexOf("# ---END_MOCK---");
          if (start !== -1 && end !== -1 && end > start) {
            content = content.slice(0, start).trim();
          }
          document.getElementById("script-view").textContent = content || "(empty)";
          showStatus('Script loaded', 'ok');
        } catch {
          showStatus('Failed to load ' + file, 'error');
          appendOutput("\n[ERROR] Failed to load " + file + "\n");
        }
      };
      list.appendChild(btn);
      if (!firstButton) firstButton = btn;
      if (file === lastScript) lastButtonToSelect = btn;
    });
  }
  // Auto-select previously opened script or the first item
  (lastButtonToSelect || firstButton)?.click();
}

// Local mode fallback message
const localMode = location.protocol === "file:";
if (localMode) {
  window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("script-view").textContent =
      "# Local mode active\n# Run a local server for full script access:\n#   python3 -m http.server 8080\n# Then open http://localhost:8080/aws/\n";
    document.getElementById("script-list").innerHTML =
      "<p style='color:var(--muted);margin:8px;'>Local mode — directory listing disabled.</p>";
  });
}

document.addEventListener("DOMContentLoaded", () => {
  if (!localMode) loadAvailableScripts();
});

// Keyboard shortcut: Ctrl/⌘ + Enter runs the current script
document.addEventListener('keydown', (e) => {
  const isMac = navigator.platform.toUpperCase().includes('MAC');
  if ((isMac ? e.metaKey : e.ctrlKey) && e.key === 'Enter') {
    const runBtn = document.getElementById('run-btn');
    if (!runBtn.disabled) runBtn.click();
  }
});
</script>
</body>
</html>
