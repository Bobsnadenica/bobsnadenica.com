<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Level 5: CloudFormation | Tech Knowledge Hub</title>
  <style>
    :root {
      --bg-body: #0a0d12;
      --bg-surface: #161b22;
      --bg-card: #0d1117;
      --border-subtle: rgba(240, 246, 252, 0.1);
      --border-hover: rgba(56, 139, 253, 0.4);
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      
      --accent-primary: #eb6f92; /* Pink/Red for IaC */
      --accent-code: #ff7b72;
      --accent-success: #2ea043;
      --accent-warn: #d29922;
      --accent-event: #8b949e;
      
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--bg-body);
      background-image: 
        radial-gradient(circle at 85% 10%, rgba(235, 111, 146, 0.08), transparent 25%),
        radial-gradient(circle at 15% 85%, rgba(46, 160, 67, 0.05), transparent 25%);
      color: var(--text-primary);
      font-family: var(--font-sans);
      line-height: 1.6;
      padding-bottom: 4rem;
    }

    a { text-decoration: none; color: inherit; }

    /* LAYOUT */
    .container { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; }

    /* HEADER */
    header { padding: 3rem 0; border-bottom: 1px solid var(--border-subtle); margin-bottom: 3rem; }
    .breadcrumb { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; }
    .breadcrumb a:hover { color: var(--accent-primary); }
    
    h1 {
      font-size: 3rem; font-weight: 800; letter-spacing: -0.03em; margin-bottom: 1rem;
      background: linear-gradient(90deg, #fff, var(--accent-primary));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .intro { font-size: 1.25rem; color: var(--text-secondary); max-width: 700px; }

    /* SECTIONS */
    .section-title { 
      font-size: 1.75rem; margin: 4rem 0 1.5rem; color: var(--text-primary); 
      display: flex; align-items: center; gap: 12px;
      border-left: 4px solid var(--accent-primary);
      padding-left: 1rem;
    }

    .concept-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }

    .card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: 12px; padding: 1.5rem;
      transition: transform 0.2s;
    }
    .card:hover { border-color: var(--accent-primary); transform: translateY(-2px); }
    .card h3 { color: var(--accent-primary); margin-bottom: 0.5rem; font-size: 1.1rem; }
    .card p { color: var(--text-secondary); font-size: 0.95rem; }

    /* SIMULATOR */
    .builder-console {
      display: grid; grid-template-columns: 250px 1fr 280px;
      gap: 1rem; height: 550px;
      background: #0d1117; border: 1px solid #30363d; border-radius: 12px;
      overflow: hidden; margin: 2rem 0;
    }
    @media (max-width: 900px) { .builder-console { grid-template-columns: 1fr; height: auto; } }

    .panel { display: flex; flex-direction: column; border-right: 1px solid #30363d; }
    .panel:last-child { border-right: none; }
    .panel-header {
      background: #161b22; padding: 10px 15px; font-size: 0.85rem;
      font-weight: bold; color: var(--text-secondary); border-bottom: 1px solid #30363d;
      display: flex; justify-content: space-between; align-items: center;
    }

    .resource-list { padding: 1rem; display: flex; flex-direction: column; gap: 10px; }
    .res-btn {
      background: #21262d; border: 1px solid #30363d; color: var(--text-primary);
      padding: 12px; border-radius: 6px; cursor: pointer; text-align: left;
      display: flex; align-items: center; gap: 10px; transition: all 0.2s;
    }
    .res-btn:hover { border-color: var(--accent-primary); background: #2c313a; }
    .res-btn span { font-size: 1.2rem; }

    .code-editor {
      background: #0d1117; flex-grow: 1; padding: 1rem; font-family: var(--font-mono);
      font-size: 0.85rem; color: #e6edf3; overflow-y: auto; white-space: pre;
      line-height: 1.5;
    }

    .cloud-visual {
      background: #010409; flex-grow: 1; padding: 1rem; overflow-y: auto;
      display: flex; flex-direction: column; gap: 10px;
    }
    .event-row { padding: 4px 0; border-bottom: 1px solid #21262d; color: var(--accent-event); font-size: 0.75rem; font-family: var(--font-mono); }
    
    .stack-resource {
      background: #161b22; border: 1px solid #30363d; padding: 10px; border-radius: 6px;
      display: flex; align-items: center; justify-content: space-between;
      opacity: 0.5; transition: all 0.5s;
    }
    .stack-resource.creating { border-color: var(--accent-warn); opacity: 0.8; animation: pulse 1s infinite; }
    .stack-resource.complete { border-color: var(--accent-success); opacity: 1; animation: none; }
    .status-badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: #21262d; }

    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    .action-bar { padding: 1rem; border-top: 1px solid #30363d; background: #161b22; text-align: center; }
    .btn {
      padding: 8px 16px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer;
      font-family: var(--font-sans); font-size: 0.9rem; transition: filter 0.2s;
    }
    .btn-deploy { background: var(--accent-success); color: #fff; }
    .btn-delete { background: var(--accent-code); color: #fff; margin-left: 10px; }
    .btn:hover { filter: brightness(1.1); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

    /* PREREQUISITES SECTION */
    .prereq-container {
      background: #161b22; border: 1px solid #30363d; border-radius: 12px;
      padding: 2rem; margin-top: 2rem;
    }
    .step-item { display: flex; gap: 1.5rem; margin-bottom: 2rem; }
    .step-num { 
      background: var(--bg-card); color: var(--accent-primary); border: 1px solid var(--accent-primary);
      width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 1.2rem; flex-shrink: 0;
    }
    .step-content h4 { margin-bottom: 0.5rem; color: #fff; }
    .step-content p { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
    .cmd-inline { 
      background: #000; color: #a5d6ff; padding: 2px 6px; border-radius: 4px; 
      font-family: var(--font-mono); font-size: 0.85rem; border: 1px solid #30363d;
    }

    /* DOWNLOAD BOX */
    .download-section {
      background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
      border: 1px solid var(--accent-success); border-radius: 12px;
      padding: 2rem; display: flex; flex-direction: column; gap: 1.5rem;
      margin-top: 2rem; position: relative; overflow: hidden;
    }
    .download-section::after {
      content: "LAB"; position: absolute; right: 10px; bottom: -20px;
      font-size: 6rem; color: var(--accent-success); opacity: 0.05; font-weight: 900; pointer-events: none;
    }
    .terminal-block {
      background: #000; padding: 1.2rem; border-radius: 8px; font-family: var(--font-mono);
      font-size: 0.9rem; color: #e6edf3; border: 1px solid #30363d; display: flex; flex-direction: column; gap: 0.8rem;
    }
    .t-comment { color: #6e7681; }
    .t-cmd { color: #a5d6ff; font-weight: bold; }
    .t-cmd::before { content: "$ "; color: #6e7681; font-weight: normal; }

  </style>
</head>
<body>

  <div class="container">
    <header>
      <div class="breadcrumb"><a href="index.html">‚Üê Back to Hub</a> / Cloud & Infrastructure</div>
      <h1>CloudFormation</h1>
      <p class="intro">
        Infrastructure as Code (IaC). Write a <span style="color:var(--accent-primary)">recipe</span> (YAML), and let AWS cook the infrastructure (Stack) for you.
      </p>
    </header>

    <h2 class="section-title">üèóÔ∏è Core Concepts</h2>
    <div class="concept-grid">
      <div class="card">
        <h3>The Template</h3>
        <p>A YAML file that describes the end state. <br><em>"I want 1 VPC and 2 EC2 instances."</em></p>
      </div>
      <div class="card">
        <h3>The Stack</h3>
        <p>The actual collection of resources created from your template. You manage them as a single unit.</p>
      </div>
      <div class="card">
        <h3>Drift</h3>
        <p>When someone manually changes a resource (e.g., deletes a rule) so the Stack no longer matches the Template.</p>
      </div>
    </div>

    <h2 class="section-title">üïπÔ∏è Simulator: Stack Builder</h2>
    <div class="builder-console">
      <div class="panel">
        <div class="panel-header">Resources</div>
        <div class="resource-list">
          <button class="res-btn" onclick="addResource('s3')"><span>ü™£</span> S3 Bucket</button>
          <button class="res-btn" onclick="addResource('ec2')"><span>üíª</span> EC2 Instance</button>
          <button class="res-btn" onclick="addResource('db')"><span>üóÑÔ∏è</span> RDS Database</button>
        </div>
        <div style="margin-top: auto; padding: 1rem; font-size: 0.8rem; color: #666;">
          Tip: Add resources, then Deploy.
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">template.yaml</div>
        <div class="code-editor" id="codeView">AWSTemplateFormatVersion: '2010-09-09'
Description: My First Stack

Resources:
  # Add resources from the left panel...</div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span>Cloud Events</span>
          <span id="stackStatus" style="font-size:0.7rem; color:#888;">REVIEW_IN_PROGRESS</span>
        </div>
        <div class="cloud-visual" id="visuals">
          </div>
        <div class="action-bar">
          <button id="deployBtn" class="btn btn-deploy" onclick="deployStack()">Deploy Stack</button>
          <button id="deleteBtn" class="btn btn-delete" onclick="resetStack()" disabled>Delete</button>
        </div>
      </div>
    </div>

    <h2 class="section-title">üß™ Hands-on Lab: Deploy Real Infra</h2>
    <p style="color:var(--text-secondary); margin-bottom:2rem;">
      Ready for the real thing? Follow this guide to deploy a VPC, ALB, and ECS cluster using the provided zip file.
    </p>

    <div class="prereq-container">
      <h3 style="color:#fff; margin-bottom:1.5rem; border-bottom:1px solid #30363d; padding-bottom:10px;">
        Part 1: Prerequisites (The "Foolproof" Setup)
      </h3>

      <div class="step-item">
        <div class="step-num">1</div>
        <div class="step-content">
          <h4>Install AWS CLI</h4>
          <p>You need the command line tool to talk to AWS. Open your terminal and type:</p>
          <div class="cmd-inline">aws --version</div>
          <p style="margin-top:0.5rem; font-size:0.85rem;">
            If it says "command not found", download it here: 
            <a href="https://aws.amazon.com/cli/" target="_blank" style="color:var(--accent-primary); text-decoration:underline;">AWS CLI Installer</a>
          </p>
        </div>
      </div>

      <div class="step-item">
        <div class="step-num">2</div>
        <div class="step-content">
          <h4>Get Access Keys</h4>
          <p>Go to the <strong>AWS Console > IAM > Users > Security Credentials</strong>.</p>
          <p>Click <strong>Create Access Key</strong>. You will get two strings:</p>
          <ul style="color:var(--text-secondary); font-size:0.9rem; margin-left:1.5rem; list-style-type:disc;">
            <li><strong>Access Key ID:</strong> (e.g., AKIAIOSFODNN7EXAMPLE)</li>
            <li><strong>Secret Access Key:</strong> (e.g., wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY)</li>
          </ul>
          <p style="color:var(--accent-warn); font-size:0.85rem; margin-top:5px;">‚ö†Ô∏è Save these! You won't see the secret again.</p>
        </div>
      </div>

      <div class="step-item">
        <div class="step-num">3</div>
        <div class="step-content">
          <h4>Login to Terminal</h4>
          <p>Run this command and paste your keys when asked:</p>
          <div class="cmd-inline">aws configure</div>
          <p style="margin-top:0.5rem; font-size:0.85rem; color:#8b949e;">
            Region: <strong>us-east-1</strong> (or your preferred region)<br>
            Output format: <strong>json</strong>
          </p>
        </div>
      </div>
    </div>

    <div class="download-section">
      <h3 style="color: var(--accent-success); border-bottom:1px solid rgba(46,160,67,0.3); padding-bottom:10px;">
        Part 2: Run the Lab
      </h3>
      
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <p style="color:var(--text-secondary); max-width:600px;">
          We have prepared a zip file with <strong>clean, production-ready code</strong>. 
          It contains a <code>deploy.sh</code> script that handles the complex commands for you.
        </p>
        <a href="Test/test.zip" download class="btn btn-deploy" style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
          Download test.zip
        </a>
      </div>

      <div class="terminal-block">
        <div>
          <span class="t-comment"># 1. Unzip the file and enter the folder</span>
          <div class="t-cmd">unzip test.zip</div>
          <div class="t-cmd">cd Test</div>
        </div>

        <div>
          <span class="t-comment"># 2. Make the scripts executable (Mac/Linux only)</span>
          <div class="t-cmd">chmod +x deploy.sh cleanup.sh</div>
        </div>

        <div>
          <span class="t-comment"># 3. Deploy the stack! (Takes ~5 minutes)</span>
          <div class="t-cmd">./deploy.sh</div>
          <div style="color:#8b949e; font-size:0.85rem; margin-top:5px;">> Waiting for changeset to be created...</div>
          <div style="color:#2ea043; font-size:0.85rem;">> Stack aws-test-root creation completed successfully!</div>
        </div>

        <div>
          <span class="t-comment"># 4. Cleanup (IMPORTANT: Run this when done to save money)</span>
          <div class="t-cmd">./cleanup.sh</div>
        </div>
      </div>
    </div>

  </div>

  <script>
    const codeView = document.getElementById('codeView');
    const visualPanel = document.getElementById('visuals');
    const deployBtn = document.getElementById('deployBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const statusLabel = document.getElementById('stackStatus');

    let resources = [];
    let isDeployed = false;

    // Resource definitions
    const templates = {
      s3: `
  MyBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: my-test-bucket-123`,
      
      ec2: `
  WebServer:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0c55b159cbfafe1f0
      InstanceType: t2.micro`,
      
      db: `
  MainDB:
    Type: AWS::RDS::DBInstance
    Properties:
      Engine: mysql
      DBInstanceClass: db.t3.micro
      AllocatedStorage: 20`
    };

    function addResource(type) {
      if (isDeployed) return; // Lock editing after deploy
      
      const id = Date.now();
      const templateSnippet = templates[type].replace(':', `_${id}:`);
      
      resources.push({ id, type, status: 'PENDING' });
      
      codeView.innerText += `\n${templateSnippet}`;
      
      const el = document.createElement('div');
      el.className = 'stack-resource';
      el.id = `res-${id}`;
      el.innerHTML = `
        <span style="font-weight:bold; font-size:0.9rem;">${type.toUpperCase()}</span>
        <span class="status-badge">Pending</span>
      `;
      visualPanel.appendChild(el);
      
      logEvent(`User added ${type.toUpperCase()} to template.`);
    }

    function deployStack() {
      if (resources.length === 0) {
        alert("Add some resources first!");
        return;
      }
      
      isDeployed = true;
      deployBtn.disabled = true;
      statusLabel.innerText = "CREATE_IN_PROGRESS";
      statusLabel.style.color = "#d29922";
      
      logEvent("AWS CloudFormation: USER_INITIATED_STACK_CREATE");

      // Simulate deployment sequence
      resources.forEach((res, index) => {
        setTimeout(() => {
          updateResourceStatus(res.id, 'creating');
        }, (index * 1500) + 500); 

        setTimeout(() => {
          updateResourceStatus(res.id, 'complete');
          
          if (index === resources.length - 1) {
            statusLabel.innerText = "CREATE_COMPLETE";
            statusLabel.style.color = "#2ea043";
            logEvent("Stack creation successful.");
            deleteBtn.disabled = false;
          }
        }, (index * 1500) + 2500);
      });
    }

    function updateResourceStatus(id, status) {
      const el = document.getElementById(`res-${id}`);
      const badge = el.querySelector('.status-badge');
      
      if (status === 'creating') {
        el.classList.add('creating');
        badge.innerText = "Creating...";
        logEvent(`Resource ${id} sent to backend.`);
      } else if (status === 'complete') {
        el.classList.remove('creating');
        el.classList.add('complete');
        badge.innerText = "Active";
        logEvent(`Resource ${id} created successfully.`);
      }
    }

    function resetStack() {
      if (!confirm("Are you sure you want to delete this stack?")) return;

      statusLabel.innerText = "DELETE_IN_PROGRESS";
      statusLabel.style.color = "#ff7b72";
      logEvent("USER_INITIATED_STACK_DELETE");
      
      visualPanel.style.opacity = '0.5';
      
      setTimeout(() => {
        resources = [];
        isDeployed = false;
        visualPanel.innerHTML = '';
        visualPanel.style.opacity = '1';
        codeView.innerText = `AWSTemplateFormatVersion: '2010-09-09'
Description: My First Stack

Resources:
  # Add resources from the left panel...`;
        
        statusLabel.innerText = "DELETE_COMPLETE";
        deployBtn.disabled = false;
        deleteBtn.disabled = true;
        logEvent("Stack deleted.");
      }, 2000);
    }

    function logEvent(msg) {
      const row = document.createElement('div');
      row.className = 'event-row';
      const time = new Date().toLocaleTimeString().split(' ')[0];
      row.innerText = `[${time}] ${msg}`;
      visualPanel.appendChild(row);
      visualPanel.scrollTop = visualPanel.scrollHeight;
    }
  </script>

</body>
</html>