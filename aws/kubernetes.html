<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Level 14: Kubernetes | Tech Knowledge Hub</title>
  <style>
    :root {
      --bg-body: #0a0d12;
      --bg-surface: #161b22;
      --bg-card: #0d1117;
      --border-subtle: rgba(240, 246, 252, 0.1);
      --border-hover: rgba(56, 139, 253, 0.4);
      --text-primary: #f0f6fc;
      --text-secondary: #8b949e;
      
      --accent-k8s: #326ce5;     /* Kubernetes Blue */
      --accent-pod: #2ea043;     /* Green (Healthy) */
      --accent-crash: #ff7b72;   /* Red (Crash) */
      --accent-update: #e3b341;  /* Gold (Updating) */
      --accent-v2: #a371f7;      /* Purple (Version 2) */
      
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--bg-body);
      background-image: 
        radial-gradient(circle at 80% 10%, rgba(50, 108, 229, 0.1), transparent 25%),
        radial-gradient(circle at 20% 90%, rgba(50, 108, 229, 0.05), transparent 25%);
      color: var(--text-primary);
      font-family: var(--font-sans);
      line-height: 1.6;
      padding-bottom: 4rem;
    }

    a { text-decoration: none; color: inherit; }

    /* LAYOUT */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }

    /* HEADER */
    header { padding: 3rem 0; border-bottom: 1px solid var(--border-subtle); margin-bottom: 3rem; }
    .breadcrumb { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem; }
    .breadcrumb a:hover { color: var(--accent-k8s); }
    
    h1 {
      font-size: 3rem; font-weight: 800; letter-spacing: -0.03em; margin-bottom: 1rem;
      background: linear-gradient(90deg, #fff, var(--accent-k8s));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .intro { font-size: 1.25rem; color: var(--text-secondary); max-width: 700px; }

    /* CARDS */
    .section-title { 
      font-size: 1.75rem; margin: 4rem 0 1.5rem; color: var(--text-primary); 
      display: flex; align-items: center; gap: 12px;
      border-left: 4px solid var(--accent-k8s);
      padding-left: 1rem;
    }

    .concept-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }

    .card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: 12px; padding: 1.5rem;
      transition: transform 0.2s; position: relative; overflow: hidden;
    }
    .card:hover { border-color: var(--accent-k8s); transform: translateY(-2px); }
    .card h3 { color: var(--accent-k8s); margin-bottom: 0.5rem; font-size: 1.1rem; }
    .card p { color: var(--text-secondary); font-size: 0.95rem; }

    /* GAMIFICATION: CLUSTER SIMULATOR */
    .cluster-console {
      background: #0d1117; border: 1px solid #30363d; border-radius: 12px;
      padding: 2rem; margin: 2rem 0; overflow: hidden;
      display: grid; grid-template-columns: 300px 1fr; gap: 2rem;
    }
    @media (max-width: 900px) { .cluster-console { grid-template-columns: 1fr; } }

    /* LEFT: CONTROL PANEL */
    .controls { display: flex; flex-direction: column; gap: 1.5rem; }

    .control-box {
      background: #161b22; padding: 1.5rem; border-radius: 8px; border: 1px solid #30363d;
    }
    .box-title { font-weight: bold; margin-bottom: 1rem; color: #fff; font-size: 0.9rem; text-transform: uppercase; }

    /* SLIDER */
    .slider-container { display: flex; flex-direction: column; gap: 5px; }
    .slider-label { display: flex; justify-content: space-between; font-size: 0.8rem; color: #8b949e; }
    input[type=range] { width: 100%; accent-color: var(--accent-k8s); cursor: pointer; }

    /* BUTTONS */
    .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btn {
      padding: 10px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer;
      font-family: var(--font-mono); font-size: 0.8rem; transition: filter 0.2s; color: #fff;
    }
    .btn:hover { filter: brightness(1.2); }
    .btn:disabled { filter: grayscale(1); opacity: 0.5; cursor: not-allowed; }

    .btn-update { background: var(--accent-v2); }
    .btn-rollback { background: #30363d; border: 1px solid #8b949e; }
    .btn-chaos { background: var(--accent-crash); width: 100%; margin-top: 10px; }

    .status-log {
      font-family: var(--font-mono); font-size: 0.75rem; color: #8b949e;
      height: 100px; overflow-y: auto; background: #000; padding: 10px; border-radius: 6px; border: 1px solid #30363d;
    }
    .log-line { margin-bottom: 4px; border-bottom: 1px dashed #21262d; }
    .log-hl { color: var(--accent-k8s); }

    /* RIGHT: VISUAL CLUSTER */
    .cluster-view {
      background: #010409; border: 1px solid #30363d; border-radius: 12px;
      padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;
      min-height: 400px; position: relative;
    }
    .cluster-label { 
      position: absolute; top: 10px; left: 15px; font-weight: bold; 
      color: #30363d; font-size: 2rem; user-select: none; pointer-events: none; 
    }

    /* NODES */
    .node-container {
      flex: 1; border: 2px dashed #30363d; border-radius: 8px;
      padding: 2.5rem 1rem 1rem; position: relative;
      display: flex; flex-wrap: wrap; align-content: flex-start; gap: 10px;
      transition: all 0.3s;
    }
    .node-label {
      position: absolute; top: 0; left: 0; background: #21262d; color: #8b949e;
      padding: 4px 10px; font-size: 0.7rem; font-weight: bold; border-bottom-right-radius: 8px;
    }

    /* PODS */
    .pod {
      width: 50px; height: 50px; background: var(--accent-k8s); border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; cursor: pointer; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      animation: spawn 0.4s ease-out;
    }
    .pod:hover { transform: scale(1.2); z-index: 10; }
    .pod:hover::after { 
      content: "KILL"; font-size: 0.6rem; font-weight: bold; 
      position: absolute; color: #fff; 
    }
    .pod.v2 { background: var(--accent-v2); } /* Version 2 Color */
    .pod.dead { transform: scale(0); opacity: 0; background: var(--accent-crash); }
    .pod.pending { border: 2px dashed #fff; background: transparent; animation: pulse 1s infinite; }

    @keyframes spawn { from { transform: scale(0); } to { transform: scale(1); } }
    @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

  </style>
</head>
<body>

  <div class="container">
    <header>
      <div class="breadcrumb"><a href="index.html">‚Üê Back to Hub</a> / Cloud & Infrastructure</div>
      <h1>Kubernetes (K8s)</h1>
      <p class="intro">
        The operating system for the cloud. Kubernetes is an 
        <span style="color:var(--accent-k8s)">Orchestrator</span> that manages thousands of containers automatically, 
        ensuring they are running, healthy, and scaled correctly.
      </p>
    </header>

    <h2 class="section-title">üì¶ Core Vocabulary</h2>
    <div class="concept-grid">
      <div class="card">
        <h3>üîµ The Pod</h3>
        <p>The smallest unit. Think of it as a <strong>Wrapper</strong> around your container. K8s doesn't run containers directly; it runs Pods.</p>
      </div>
      <div class="card">
        <h3>üìÑ The Deployment</h3>
        <p>The Blueprint. You tell it: "I want 3 replicas of App V1". The Deployment ensures that exactly 3 Pods are always running.</p>
      </div>
      <div class="card">
        <h3>üñ•Ô∏è The Node</h3>
        <p>The Hardware (Server). Can be a physical machine or a VM. Pods run <em>on</em> Nodes. A cluster is made of many Nodes.</p>
      </div>
      <div class="card">
        <h3>‚öì The Service</h3>
        <p>The Front Desk. Pods die and change IPs constantly. The Service gives you a <strong>stable IP</strong> to reach the fleet.</p>
      </div>
    </div>

    <h2 class="section-title">üïπÔ∏è Fleet Commander Simulator</h2>
    <p style="margin-bottom: 1rem; color: var(--text-secondary);">
      <strong>Your Role:</strong> You are the Control Plane. Define your "Desired State" and watch K8s make it happen.
      <br>Try clicking on a Pod to kill it and see <strong>Self-Healing</strong> in action.
    </p>

    <div class="cluster-console">
      
      <div class="controls">
        
        <div class="control-box">
          <div class="box-title">Desired State</div>
          <div class="slider-container">
            <div class="slider-label">
              <span>Replicas</span>
              <span id="replicaVal" style="color:#fff; font-weight:bold;">3</span>
            </div>
            <input type="range" id="scaleSlider" min="0" max="12" value="3" oninput="updateDesiredState()">
          </div>
        </div>

        <div class="control-box">
          <div class="box-title">Deployment Strategy</div>
          <div class="btn-grid">
            <button class="btn btn-update" onclick="startRollingUpdate()">üöÄ Update to v2</button>
            <button class="btn btn-rollback" onclick="rollback()">‚Ü©Ô∏è Rollback</button>
          </div>
          <button class="btn btn-chaos" onclick="triggerChaos()">‚òÑÔ∏è Chaos Monkey (Kill Random)</button>
        </div>

        <div class="status-log" id="k8sLog">
          <div class="log-line">> Cluster Initialized.</div>
          <div class="log-line">> Waiting for instructions...</div>
        </div>

      </div>

      <div class="cluster-view">
        <div class="cluster-label">K8s Cluster</div>
        
        <div class="node-container" id="node1">
          <div class="node-label">Node-01 (2 Core / 4GB)</div>
          </div>

        <div class="node-container" id="node2">
          <div class="node-label">Node-02 (2 Core / 4GB)</div>
          </div>

      </div>
    </div>

    <h2 class="section-title">üß† Why is it so popular?</h2>
    <div class="concept-grid">
      <div class="card">
        <h3>Self-Healing</h3>
        <p>If a server crashes at 3 AM, you don't wake up. K8s detects the dead node and moves the Pods to a healthy node automatically.</p>
      </div>
      <div class="card">
        <h3>Rolling Updates</h3>
        <p>Update your app from v1 to v2 with <strong>Zero Downtime</strong>. K8s replaces Pods one by one, ensuring traffic is only sent to healthy instances.</p>
      </div>
      <div class="card">
        <h3>Bin Packing</h3>
        <p>K8s is like Tetris. It fits as many containers as possible onto your servers to save money on cloud bills.</p>
      </div>
    </div>

  </div>

  <script>
    const slider = document.getElementById('scaleSlider');
    const replicaVal = document.getElementById('replicaVal');
    const logBox = document.getElementById('k8sLog');
    const node1 = document.getElementById('node1');
    const node2 = document.getElementById('node2');

    let desiredReplicas = 3;
    let currentVersion = 'v1'; // v1 or v2
    let activePods = [];

    // Initialize
    setInterval(reconcileLoop, 1000); // The "Control Loop" runs every second
    updateDesiredState();

    function log(msg) {
      const line = document.createElement('div');
      line.className = 'log-line';
      line.innerHTML = `> <span class="log-hl">[K8s-Master]</span> ${msg}`;
      logBox.prepend(line);
    }

    function updateDesiredState() {
      desiredReplicas = parseInt(slider.value);
      replicaVal.innerText = desiredReplicas;
    }

    // THE BRAIN: Reconcile Loop
    function reconcileLoop() {
      // 1. Clean up dead pods from array
      activePods = activePods.filter(p => p.element.isConnected && !p.isDead);

      const currentCount = activePods.length;

      if (currentCount < desiredReplicas) {
        // We need more pods!
        createPod();
      } else if (currentCount > desiredReplicas) {
        // We have too many! Kill one.
        deletePod();
      }
    }

    function createPod() {
      const podId = Math.floor(Math.random() * 9999);
      const podVer = currentVersion;
      
      const el = document.createElement('div');
      el.className = `pod ${podVer === 'v2' ? 'v2' : ''}`;
      el.innerText = "üê≥";
      el.title = `Pod-${podId} (${podVer})`;
      el.onclick = () => killPod(podId); // Click to kill (Chaos)

      // Simple scheduler: Round robin between Node 1 and Node 2
      const targetNode = (activePods.length % 2 === 0) ? node1 : node2;
      targetNode.appendChild(el);

      activePods.push({ id: podId, version: podVer, element: el, isDead: false });
      log(`Scheduled Pod-${podId} on ${targetNode.id === 'node1' ? 'Node-01' : 'Node-02'}`);
    }

    function deletePod() {
      // Find a pod to delete (preferably older version if mixing, or just last one)
      const victim = activePods.pop(); // Remove from tracking array
      if (victim) {
        victim.isDead = true;
        victim.element.classList.add('dead'); // Animation
        setTimeout(() => victim.element.remove(), 400); // Remove from DOM
        log(`Scaled down: Terminated Pod-${victim.id}`);
      }
    }

    function killPod(id) {
      const pod = activePods.find(p => p.id === id);
      if (pod && !pod.isDead) {
        pod.isDead = true;
        pod.element.classList.add('dead');
        setTimeout(() => pod.element.remove(), 400);
        log(`‚ö†Ô∏è CRASH DETECTED: Pod-${id} died unexpectedly!`);
        // The Reconcile Loop will automatically spawn a replacement in 1 second
      }
    }

    function triggerChaos() {
      if (activePods.length === 0) return;
      const victim = activePods[Math.floor(Math.random() * activePods.length)];
      killPod(victim.id);
    }

    function startRollingUpdate() {
      if (currentVersion === 'v2') return;
      currentVersion = 'v2';
      log(`üöÄ Deployment updated: Image set to MyApp:v2. Starting Rolling Update...`);
      
      // The reconcile loop creates new pods with currentVersion. 
      // To simulate rolling update, we need to kill old v1 pods slowly so loop replaces them with v2.
      let killed = 0;
      activePods.forEach((p, index) => {
        if (p.version === 'v1') {
          setTimeout(() => {
            killPod(p.id); // Hack: We treat "update" as "killing old so new spawns"
          }, index * 1500); // Slow replace every 1.5s
        }
      });
    }

    function rollback() {
      if (currentVersion === 'v1') return;
      currentVersion = 'v1';
      log(`‚Ü©Ô∏è Rolling back to MyApp:v1...`);
      // Kill v2 pods slowly
      activePods.forEach((p, index) => {
        if (p.version === 'v2') {
          setTimeout(() => {
            killPod(p.id);
          }, index * 1000);
        }
      });
    }

  </script>

</body>
</html>