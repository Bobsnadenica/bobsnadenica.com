<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CandBox — Tiny ASCII Incremental</title>
  <style>
    :root {
      --bg: #0f0f14; --panel:#16161d; --muted:#7a7aa0; --text:#e5e7eb; --accent:#8b5cf6; --good:#22c55e; --bad:#ef4444; --gold:#f59e0b;
    }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: var(--bg); color: var(--text); }
    .container { max-width: 980px; margin: 0 auto; padding: 24px; }
    .title { font-size: 28px; letter-spacing: .5px; }
    .subtitle { color: var(--muted); font-size: 14px; }
    .grid { display: grid; grid-template-columns: 1.1fr .9fr; gap: 16px; }
    .card { background: var(--panel); border: 1px solid #24243a; border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .stats { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 8px; margin-bottom: 12px; }
    .stat { background: #111119; border: 1px solid #24243a; border-radius: 12px; padding: 10px; text-align: center; }
    .stat b { display:block; font-size: 18px; }
    .row { display:flex; gap:8px; flex-wrap: wrap; }
    button { background: #1f1f2b; color: var(--text); border: 1px solid #2a2a43; border-radius: 10px; padding: 10px 12px; cursor: pointer; transition:.15s transform, .15s background; }
    button:hover { transform: translateY(-1px); background:#24243a; }
    button:disabled{ opacity:.4; cursor:not-allowed; transform:none; }
    .accent { border-color: #5b21b6; }
    .good { color: var(--good); }
    .bad { color: var(--bad); }
    .gold { color: var(--gold); }
    pre.log { height: 260px; overflow: auto; background:#0b0b11; border:1px solid #24243a; border-radius:12px; padding:12px; line-height:1.45; }
    .section-title { color: var(--muted); margin:.5rem 0 .25rem; letter-spacing:.3px; }
    .shop-item { display:flex; align-items:center; justify-content:space-between; padding:8px 0; border-bottom:1px dashed #2a2a43; }
    .shop-item:last-child{ border-bottom:none; }
    details { border: 1px dashed #2a2a43; border-radius: 12px; padding: 10px 12px; }
    summary { cursor: pointer; color: var(--muted); }
    .kbd { padding:2px 6px; border:1px solid #2a2a43; border-bottom-width:2px; border-radius:6px; background:#10101a; font-size:12px; }
    .footer { color:#8b8bb5; font-size:12px; margin-top:10px; }
    .hr { height:1px; background: #24243a; margin: 10px 0; border-radius:2px; }
  </style>
</head>
<body>
  <div class="container">
    <div style="margin-bottom:12px">
      <div class="title">CandBox <span style="color:var(--accent)">▮</span></div>
      <div class="subtitle">A tiny ASCII incremental inspired by <i>Candy Box</i> — single-file, offline, autosaving.</div>
    </div>

    <div class="grid">
      <!-- LEFT: Game View -->
      <div class="card">
        <div class="stats">
          <div class="stat"><span>🍬 Candies</span><b id="candies">0</b><small id="cps" class="good">+0/s</small></div>
          <div class="stat"><span>🪙 Gold</span><b id="gold">0</b></div>
          <div class="stat"><span>⚔️ Power</span><b id="power">0</b><small id="weapon">fists</small></div>
        </div>

        <div class="row" style="margin-bottom:10px">
          <button id="btnEat">Eat 10 🍬 (+1 HP)</button>
          <button id="btnThrow">Throw 10 🍬 (fun)</button>
          <button id="btnQuest" class="accent">Go on adventure</button>
        </div>

        <div class="section-title">Adventure</div>
        <div id="adventure" style="display:none">
          <div class="row" style="margin-bottom:8px">
            <div class="stat" style="flex:1"><span>❤️ Your HP</span><b id="hp">20</b></div>
            <div class="stat" style="flex:1"><span>👾 Foe HP</span><b id="foeHp">-</b></div>
          </div>
          <div class="row" style="margin-bottom:8px">
            <button id="btnStrike">Strike (space)</button>
            <button id="btnFlee">Flee</button>
          </div>
        </div>

        <div class="section-title">Log</div>
        <pre class="log" id="log"></pre>
      </div>

      <!-- RIGHT: Shop / Inventory -->
      <div class="card">
        <div class="section-title">Shop</div>
        <div id="shop">
          <div class="shop-item">
            <div>🍭 Lollipop <small class="muted">(+0.2 🍬/s)</small></div>
            <div>
              <span id="costLollipop" class="gold">10 🍬</span>
              <button id="buyLollipop">Buy</button>
            </div>
          </div>
          <div class="shop-item">
            <div>🗡️ Wooden Sword <small>Power 2</small></div>
            <div>
              <span class="gold">20 🪙</span>
              <button id="buySwordWood">Buy</button>
            </div>
          </div>
          <div class="shop-item">
            <div>⚔️ Iron Sword <small>Power 5</small></div>
            <div>
              <span class="gold">60 🪙</span>
              <button id="buySwordIron">Buy</button>
            </div>
          </div>
          <div id="farmWrap" class="shop-item" style="display:none">
            <div>🌾 Candy Farm <small>+1 🍬/s (passive)</small></div>
            <div>
              <span class="gold">250 🍬</span>
              <button id="buyFarm">Buy</button>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="section-title">Inventory</div>
        <details open>
          <summary>Show / hide</summary>
          <ul id="inventory"></ul>
        </details>

        <div class="hr"></div>
        <div class="row">
          <button id="saveBtn">Save</button>
          <button id="loadBtn">Load</button>
          <button id="wipeBtn">Reset</button>
        </div>
        <div class="footer">Tips: Press <span class="kbd">space</span> to strike in combat. Earn gold by winning fights. Unlock the farm at 100 🍬.</div>
      </div>
    </div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);
    const fmt = (n) => Math.floor(n).toLocaleString();

    const state = {
      candies: 0,
      gold: 0,
      lollipops: 0,
      farm: 0,
      cps: 0,
      hp: 20,
      hpMax: 20,
      power: 0,
      weapon: 'fists',
      inventory: [],
      inFight: false,
      foe: null,
      lollipopCost: 10,
    };

    const weapons = {
      wood: { name: 'wooden sword', power: 2, costGold: 20 },
      iron: { name: 'iron sword', power: 5, costGold: 60 },
    };

    const foes = [
      { name:'Rat', hp:10, dmg:[1,2], reward:{ gold:[3,7], candy:[5,10] } },
      { name:'Goblin', hp:18, dmg:[2,4], reward:{ gold:[8,15], candy:[8,15] } },
      { name:'Ogre', hp:30, dmg:[3,6], reward:{ gold:[15,30], candy:[15,25] } },
    ];

    function log(msg) {
      const p = el('log');
      const time = new Date().toLocaleTimeString();
      p.textContent += `[${time}] ${msg}\n`;
      p.scrollTop = p.scrollHeight;
    }

    function recalcCps() {
      state.cps = state.lollipops * 0.2 + state.farm * 1;
      el('cps').textContent = `+${state.cps.toFixed(1)}/s`;
    }

    function render() {
      el('candies').textContent = fmt(state.candies);
      el('gold').textContent = fmt(state.gold);
      el('power').textContent = state.power;
      el('weapon').textContent = state.weapon;
      el('hp').textContent = state.hp;
      el('costLollipop').textContent = `${state.lollipopCost} 🍬`;
      // inventory
      el('inventory').innerHTML = state.inventory.map(i => `<li>• ${i}</li>`).join('');
      // unlocks
      el('farmWrap').style.display = state.candies >= 100 || state.farm>0 ? 'flex' : 'none';
      // buttons
      el('btnEat').disabled = state.candies < 10 || state.hp >= state.hpMax;
      el('btnThrow').disabled = state.candies < 10;
      el('buyLollipop').disabled = state.candies < state.lollipopCost;
      el('buySwordWood').disabled = state.gold < weapons.wood.costGold || state.power >= weapons.wood.power;
      el('buySwordIron').disabled = state.gold < weapons.iron.costGold || state.power >= weapons.iron.power;
      el('buyFarm').disabled = state.candies < 250;
      el('btnQuest').disabled = state.inFight;
      el('btnStrike').disabled = !state.inFight;
      el('btnFlee').disabled = !state.inFight;
    }

    function save() {
      localStorage.setItem('candbox-save', JSON.stringify(state));
      log('Game saved.');
    }

    function load() {
      const raw = localStorage.getItem('candbox-save');
      if (!raw) return log('No save found.');
      const data = JSON.parse(raw);
      Object.assign(state, data);
      recalcCps();
      render();
      log('Loaded save.');
    }

    function reset() {
      localStorage.removeItem('candbox-save');
      location.reload();
    }

    // Passive tick
    setInterval(() => {
      state.candies += state.cps;
      render();
    }, 1000);

    // Autosave
    setInterval(() => save(), 10000);

    // Buttons
    el('btnEat').onclick = () => {
      if (state.candies < 10 || state.hp >= state.hpMax) return;
      state.candies -= 10; state.hp = Math.min(state.hpMax, state.hp + 1);
      log('You savor 10 candies. Tasty! (+1 HP)');
      render();
    };

    el('btnThrow').onclick = () => {
      if (state.candies < 10) return;
      state.candies -= 10; log('You throw 10 candies into the void. The void is pleased.');
      render();
    };

    el('buyLollipop').onclick = () => {
      if (state.candies < state.lollipopCost) return;
      state.candies -= state.lollipopCost;
      state.lollipops += 1;
      state.lollipopCost = Math.ceil(state.lollipopCost * 1.25);
      state.inventory.push('lollipop');
      recalcCps();
      log('You bought a lollipop. Sweet productivity ensues.');
      render();
    };

    el('buyFarm').onclick = () => {
      if (state.candies < 250) return;
      state.candies -= 250; state.farm += 1; recalcCps();
      state.inventory.push('tiny candy farm');
      log('You establish a tiny candy farm. The soil smells sugary. (+1 🍬/s)');
      render();
    };

    el('buySwordWood').onclick = () => buyWeapon('wood');
    el('buySwordIron').onclick = () => buyWeapon('iron');

    function buyWeapon(key) {
      const w = weapons[key];
      if (state.gold < w.costGold) return;
      if (state.power >= w.power) return log('You already wield something stronger.');
      state.gold -= w.costGold; state.power = w.power; state.weapon = w.name; state.inventory.push(w.name);
      log(`You bought a ${w.name}. It hums faintly.`);
      render();
    }

    // Adventure / Combat
    el('btnQuest').onclick = () => startFight();
    el('btnFlee').onclick = () => endFight('You flee. The foe laughs.');
    el('btnStrike').onclick = () => strike();

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); if (state.inFight) strike(); }
    });

    function startFight() {
      if (state.inFight) return;
      state.inFight = true; el('adventure').style.display = 'block';
      const base = foes[Math.floor(Math.random()*foes.length)];
      state.foe = { ...base, hp: base.hp };
      el('foeHp').textContent = state.foe.hp;
      log(`You encounter a ${state.foe.name}!`);
      render();
      // foe auto-attacks
      state.foeTimer = setInterval(() => {
        if (!state.inFight) return;
        const [min,max] = state.foe.dmg; const dmg = randInt(min,max);
        state.hp = Math.max(0, state.hp - dmg);
        el('hp').textContent = state.hp;
        log(`The ${state.foe.name} hits you for ${dmg}.`);
        if (state.hp <= 0) {
          endFight('You fall... but awaken near a pile of candies. (-10 🍬)');
          state.candies = Math.max(0, state.candies - 10);
          state.hp = state.hpMax;
          render();
        }
      }, 1200);
    }

    function strike() {
      if (!state.inFight) return;
      const dmg = Math.max(1, 1 + state.power);
      state.foe.hp = Math.max(0, state.foe.hp - dmg);
      el('foeHp').textContent = state.foe.hp;
      log(`You strike for ${dmg}.`);
      if (state.foe.hp <= 0) {
        const gold = randInt(...state.foe.reward.gold);
        const candy = randInt(...state.foe.reward.candy);
        state.gold += gold; state.candies += candy;
        log(`Victory! +${gold} 🪙, +${candy} 🍬`);
        endFight('The path is clear.');
        render();
      }
    }

    function endFight(msg) {
      state.inFight = false; clearInterval(state.foeTimer); state.foeTimer = null; state.foe = null;
      el('adventure').style.display = 'none'; el('foeHp').textContent = '-';
      log(msg);
      render();
    }

    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    // Save controls
    el('saveBtn').onclick = save;
    el('loadBtn').onclick = load;
    el('wipeBtn').onclick = reset;

    // Boot
    recalcCps();
    render();
    log('Welcome to CandBox. Candies will accumulate over time. Buy lollipops to boost income.');
  </script>
</body>
</html>
