<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Is it gay?</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #0f0f0f, #1a1a1a, #111);
        color: #fff;
        text-align: center;
        padding: 40px;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1 {
        font-size: 2.8em;
        margin-top: 10px;
    }

    #question-box {
        margin-top: 40px;
        background: #222;
        padding: 30px;
        border-radius: 12px;
        display: inline-block;
        max-width: 400px;
        width: 90%;
        position: relative;
        touch-action: pan-y;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
        backdrop-filter: blur(6px);
        border: 1px solid rgba(255,255,255,0.07);
    }

    #question-box::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 14px;
        padding: 2px;
        background: linear-gradient(135deg, #ff5faa, #00ffbf, #ffe600);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: exclude;
        -webkit-mask-composite: xor;
        opacity: 0.2;
        transition: opacity 0.4s ease;
    }

    #question-box:hover::before {
        opacity: 0.45;
    }


    .card-animate {
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: scale(0.95);
        opacity: 0;
    }

    .card-animate.show {
        transform: scale(1);
        opacity: 1;
    }


    #question-image {
        width: 100%;
        max-width: 300px;
        max-height: 45vh;
        border-radius: 10px;
        margin: 25px auto 0 auto;
        display: none;
        object-fit: cover;
        object-position: center 10%;
    }

    button {
        font-size: 1.2em;
        padding: 12px 24px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: #444;
        color: #fff;
        transition: 0.2s;
    }

    button:hover {
        background: #666;
    }

    #profile-vertical {
        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.7);
        border: 1px solid rgba(255,255,255,0.14);
        backdrop-filter: blur(10px);
    }

    #profile-vertical-text {
        text-shadow: 0 0 14px rgba(0,0,0,0.8);
        max-width: 180px;
        text-align: right;
        line-height: 1.3;
    }

    @media (max-width: 600px) {
        body {
            padding: 24px 12px;
        }
        h1 {
            font-size: 2.2em;
            margin-top: 4px;
        }
        #question-box {
            margin-top: 24px;
            padding: 20px 16px;
        }
        #profile-vertical {
            right: 10px;
            height: 220px;
        }
        #profile-vertical-text {
            right: 52px;
            font-size: 0.95em;
        }
    }
</style>
</head>
<body>

<h1 id="title-main" style="font-weight:800; letter-spacing:1.5px; text-shadow:0 6px 22px rgba(0,0,0,0.7); font-size:2.8em; margin-top:10px;">
    Is it gay?
</h1>
<div id="profile-vertical" style="position:fixed; right:20px; top:50%; transform:translateY(-50%); width:22px; height:320px; background:rgba(15,15,15,0.9); border-radius:14px; overflow:hidden; z-index:50; box-shadow:0 12px 32px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.12); backdrop-filter:blur(10px);">
    <div id="gay-ticks" style="position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none;">
        <div style="position:absolute; bottom:0%; width:100%; height:2px; background:rgba(255,255,255,0.35);"></div>
        <div style="position:absolute; bottom:25%; width:100%; height:2px; background:rgba(255,255,255,0.25);"></div>
        <div style="position:absolute; bottom:50%; width:100%; height:2px; background:rgba(255,255,255,0.25);"></div>
        <div style="position:absolute; bottom:75%; width:100%; height:2px; background:rgba(255,255,255,0.25);"></div>
        <div style="position:absolute; bottom:100%; width:100%; height:2px; background:rgba(255,255,255,0.45);"></div>
    </div>
    <div id="profile-vertical-fill" style="width:100%; height:0%; background:linear-gradient(180deg,#0ff,#0f0,#ff0,#f00,#ff00ff); transition:height 0.8s ease-in-out;"></div>
</div>
<div id="profile-vertical-text" style="position:fixed; right:60px; top:50%; transform:translateY(-50%); font-size:1.1em; opacity:0.9; text-shadow:0 0 14px rgba(0,0,0,0.7); max-width:180px; text-align:right;">
    Total gayness: 0%
</div>

<div id="question-box" 
     class="card-animate"
     ontouchstart="handleTouchStart(event)" 
     ontouchmove="handleTouchMove(event)"
     ontouchend="handleTouchEnd(event)"
     onmousedown="handleMouseDown(event)"
     onmousemove="handleMouseMove(event)"
     onmouseup="handleMouseUp(event)"
     onmouseleave="handleMouseUp(event)"
>
    <h2 id="question">Loading question...</h2>
    <div id="swipe-hint-left" style="position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:0; font-size:1.5em; color:#ff5080; text-shadow:0 0 14px rgba(255,80,128,0.7); pointer-events:none;">NO ðŸ‘ˆ</div>
    <div id="swipe-hint-right" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); opacity:0; font-size:1.5em; color:#00ffb3; text-shadow:0 0 14px rgba(0,255,179,0.7); pointer-events:none;">ðŸ‘‰ YES</div>
    <img id="question-image" src="" alt="">
</div>

<div id="popup" style="display:none; opacity:0; transition:opacity 0.25s ease-out; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(30,30,30,0.9); padding:32px 46px; border-radius:20px; font-size:1.8em; z-index:999; box-shadow:0 25px 45px rgba(0,0,0,0.55); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.1);">
    <span id="popup-text"></span>
</div>

<script>
    let questionsEN = [];
    let totalPoints = 0;
    let answeredQuestions = 0;
    let yesNoResponses = { yes: [], no: [] };
    let usedQuestions = new Set();
    const gayFinale = new Audio("azis.mp3");
    gayFinale.volume = 1.0;
    // ðŸ”Š Mobile autoplay fix â€” browsers block audio until a user gesture unlocks it
    let audioUnlocked = false;
    function unlockAudio() {
        if (!audioUnlocked) {
            gayFinale.play().then(() => {
                gayFinale.pause();
                gayFinale.currentTime = 0;
                audioUnlocked = true;
                console.log("Audio unlocked on mobile");
            }).catch(() => {});
        }
    }
    window.addEventListener("touchstart", unlockAudio, { once: true });
    window.addEventListener("click", unlockAudio, { once: true });
    let gayFinaleStarted = false;

    // Tinder-style drag & release
    let isDragging = false;
    let dragStartX = null;
    let dragStartY = null;
    let lastDragX = null;
    let lastDragY = null;
    let isLocked = false;

    function getCardElement() {
        return document.getElementById("question-box");
    }

    function startDrag(x, y) {
        if (isLocked) return;
        isDragging = true;
        dragStartX = x;
        dragStartY = y;
        lastDragX = x;
        lastDragY = y;
        const card = getCardElement();
        card.style.transition = "none";
    }

    function moveDrag(x, y) {
        if (!isDragging) return;
        lastDragX = x;
        lastDragY = y;
        const dx = x - dragStartX;
        const rotation = dx / 25;
        const card = getCardElement();

        const scale = 1 + Math.min(Math.abs(dx) / 600, 0.05);
        card.style.transform = `translateX(${dx}px) rotate(${rotation}deg) scale(${scale})`;

        const hintLeft = document.getElementById("swipe-hint-left");
        const hintRight = document.getElementById("swipe-hint-right");

        const show = Math.min(Math.abs(dx) / 120, 1);

        if (dx < 0) {
            hintLeft.style.opacity = show;
            hintRight.style.opacity = 0;
        } else {
            hintRight.style.opacity = show;
            hintLeft.style.opacity = 0;
        }

        const intensity = Math.min(Math.abs(dx) / 150, 1);
        if (dx > 0) {
            card.style.boxShadow = `0 18px 40px rgba(0, 255, 170, ${0.2 + intensity * 0.4})`;
        } else if (dx < 0) {
            card.style.boxShadow = `0 18px 40px rgba(255, 60, 130, ${0.2 + intensity * 0.4})`;
        } else {
            card.style.boxShadow = "0 12px 30px rgba(0, 0, 0, 0.4)";
        }
    }

    function endDrag(x, y) {
        if (!isDragging) return;
        isDragging = false;

        const card = getCardElement();
        const dx = x - dragStartX;
        const threshold = 70;

        if (Math.abs(dx) > threshold && !isLocked) {
            const direction = dx > 0 ? "yes" : "no";
            const offscreenX = dx > 0 ? window.innerWidth : -window.innerWidth;

            card.style.transition = "transform 0.25s ease-out, box-shadow 0.25s ease-out";
            card.style.transform = `translateX(${offscreenX}px) rotate(${dx > 0 ? 20 : -20}deg)`;

            setTimeout(() => {
                // Reset for next card; answer() will trigger popup + new question
                card.style.transition = "transform 0.3s ease, opacity 0.3s ease";
                card.style.transform = "translateX(0) rotate(0deg)";
                card.style.boxShadow = "0 12px 30px rgba(0, 0, 0, 0.4)";
                answer(direction);
            }, 220);
        } else {
            // Not enough swipe -> snap back
            card.style.transition = "transform 0.2s ease-out, box-shadow 0.2s ease-out";
            card.style.transform = "translateX(0) rotate(0deg)";
            card.style.boxShadow = "0 12px 30px rgba(0, 0, 0, 0.4)";
            setTimeout(() => {
                card.style.transition = "transform 0.3s ease, opacity 0.3s ease";
            }, 220);
        }
        document.getElementById("swipe-hint-left").style.opacity = 0;
        document.getElementById("swipe-hint-right").style.opacity = 0;
    }

    // Touch wrappers
    function handleTouchStart(evt) {
        const t = evt.touches[0];
        startDrag(t.clientX, t.clientY);
    }

    function handleTouchMove(evt) {
        if (!isDragging) return;
        const t = evt.touches[0];
        moveDrag(t.clientX, t.clientY);
    }

    function handleTouchEnd(evt) {
        if (dragStartX === null || dragStartY === null) return;
        endDrag(lastDragX ?? dragStartX, lastDragY ?? dragStartY);
    }

    // Mouse wrappers (desktop)
    function handleMouseDown(evt) {
        startDrag(evt.clientX, evt.clientY);
    }

    function handleMouseMove(evt) {
        if (!isDragging) return;
        moveDrag(evt.clientX, evt.clientY);
    }

    function handleMouseUp(evt) {
        if (!dragStartX && !dragStartY) return;
        endDrag(evt.clientX, evt.clientY);
    }

    function loadQuestions() {
        fetch('questions.json')
            .then(r => r.json())
            .then(data => {
                questionsEN = data.questions_en;
                return fetch('yes_no.json');
            })
            .then(r => r.json())
            .then(responses => {
                yesNoResponses = responses;
                loadRandomQuestion();
            })
            .catch(err => {
                console.error("Failed to load questions or responses:", err);
                const qEl = document.getElementById("question");
                if (qEl) {
                    qEl.textContent = "Error loading questions.";
                }
            });
    }

    function launchConfetti() {
        const body = document.body;
        for (let i = 0; i < 20; i++) {
            const c = document.createElement("div");
            c.style.position = "fixed";
            c.style.width = "8px";
            c.style.height = "8px";
            c.style.background = `hsl(${Math.random()*360}, 90%, 60%)`;
            c.style.top = "-10px";
            c.style.left = (Math.random() * window.innerWidth) + "px";
            c.style.opacity = "0.9";
            c.style.transform = "translateY(0)";
            c.style.transition = "transform 1.4s ease-out, opacity 1.4s ease-out";
            body.appendChild(c);
            requestAnimationFrame(() => {
                c.style.transform = "translateY(120vh)";
                c.style.opacity = "0";
            });
            setTimeout(() => c.remove(), 1500);
        }
    }

    function getList() {
        return questionsEN;
    }

    function loadRandomQuestion() {
        isLocked = false;

        const box = document.getElementById("question-box");
        box.style.transform = "translateX(0) rotate(0deg)";
        box.style.boxShadow = "0 12px 30px rgba(0, 0, 0, 0.4)";
        box.classList.remove("show");
        void box.offsetWidth;
        box.classList.add("show");

        const list = getList();
        if (list.length === 0) return;

        if (usedQuestions.size === list.length) {
            usedQuestions.clear();
        }

        let q;
        do {
            q = list[Math.floor(Math.random() * list.length)];
        } while (usedQuestions.has(q.text) && usedQuestions.size < list.length);

        usedQuestions.add(q.text);

        document.getElementById("question").textContent = q.text;
        window.currentPointsYes = q.points_yes || 0;
        window.currentPointsNo = q.points_no || 100;

        const img = document.getElementById("question-image");
        if (q.image) {
            img.src = "pictures/" + q.image;
            img.style.display = "block";
        } else {
            img.style.display = "none";
        }
    }

    function updateProfileBar() {
        // totalPoints now maps to max 1000 â†’ 100%
        let percent = Math.min(100, Math.floor((totalPoints / 1000) * 100));
        const fillEl = document.getElementById("profile-vertical-fill");
        const textEl = document.getElementById("profile-vertical-text");
        if (fillEl) {
            fillEl.style.height = percent + "%";
            if (percent === 25 || percent === 50 || percent === 75) {
                launchConfetti();
            }
            if (percent === 100 && !gayFinaleStarted) {
                launchConfetti();
                gayFinaleStarted = true;
                gayFinale.currentTime = 0;
                gayFinale.volume = 1.0; // blast max volume
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 300]); // vibration pattern
                }
                gayFinale.loop = true;
                gayFinale.play();
            }
        }
        if (textEl) {
            textEl.textContent = "Total gayness: " + percent + "%";
        }

        const body = document.body;

        if (percent >= 90) {
            body.style.background = "url('gay.jpg') center center / cover no-repeat fixed";
        } else if (percent < 20) {
            body.style.background = "linear-gradient(135deg, #0f0f0f, #1a1a1a, #111)";
        } else if (percent < 40) {
            body.style.background = "linear-gradient(135deg, #112233, #223344, #334455)";
        } else if (percent < 60) {
            body.style.background = "linear-gradient(135deg, #331144, #552277, #663388)";
        } else if (percent < 80) {
            body.style.background = "linear-gradient(135deg, #550044, #aa0066, #ff0099)";
        } else {
            body.style.background = "linear-gradient(135deg, #ff0088, #ff33aa, #ff66cc)";
        }
    }

    function answer(choice) {
        if (isLocked) return;
        isLocked = true;

        let list = choice === 'yes' ? yesNoResponses.yes : yesNoResponses.no;
        let randomResponse = "OK";
        if (Array.isArray(list) && list.length > 0) {
            randomResponse = list[Math.floor(Math.random() * list.length)];
        }

        const popup = document.getElementById("popup");
        document.getElementById("popup-text").textContent = randomResponse;
        popup.style.display = "block";
        popup.style.transition = "opacity 0.25s ease-out, transform 0.25s ease-out";
        popup.style.transform = "translate(-50%, -50%) scale(0.9)";
        popup.style.opacity = 0;

        setTimeout(() => {
            popup.style.opacity = 1;
            popup.style.transform = "translate(-50%, -50%) scale(1)";
        }, 20);

        if (choice === 'yes') {
            totalPoints += currentPointsYes;
        } else {
            totalPoints += currentPointsNo;
        }

        answeredQuestions++;
        updateProfileBar();

        setTimeout(() => {
            popup.style.opacity = 0;
            popup.style.transform = "translate(-50%, -50%) scale(0.9)";
            setTimeout(() => {
                popup.style.display = "none";
            }, 250);
        }, 1500);

        setTimeout(() => {
            loadRandomQuestion();
        }, 1600);
    }

    loadQuestions();
</script>

</body>
</html>