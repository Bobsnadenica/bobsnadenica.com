<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü.–ï.–î.–ê.–õ.—à ‚Äî –ü—É–±–ª–∏—á–µ–Ω –ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω –î–æ—Å—Ç—ä–ø –∑–∞ –ê–Ω–∞–ª–∏–∑ –Ω–∞ –õ–æ—à–∏ —à–æ—Ñ—å–æ—Ä–∏</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: {
            asphalt: '#0f0f0f',
          },
        },
      },
    };
  </script>
  <style>
    html, body { font-family: 'Inter', system-ui, sans-serif; }
    * { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-6 flex flex-col gap-6">
    <!-- Top App Bar -->
    <header class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-red-500 to-yellow-400 flex items-center justify-center shadow-lg">
          <span class="font-extrabold text-slate-950 text-lg">–ü</span>
        </div>
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
            –ü.–ï.–î.–ê.–õ.—à
          </h1>
          <p class="text-xs sm:text-sm text-slate-400">
            –ü—É–±–ª–∏—á–µ–Ω –ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω –î–æ—Å—Ç—ä–ø –∑–∞ –ê–Ω–∞–ª–∏–∑ –Ω–∞ –õ–æ—à–∏ —à–æ—Ñ—å–æ—Ä–∏ ‚Äî —Ç–∞–±–ª–æ –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª–Ω–æ –ø–∞—Ä–∫–∏—Ä–∞–Ω–µ –∏ –≥—Ä—É–±–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –ø—ä—Ç—è.
          </p>
        </div>
      </div>
    </header>

    <!-- Slogan -->
    <p class="text-center text-sm sm:text-base text-slate-400 font-medium mt-1">
      –ü–∞—Ä–∫–∏—Ä–∞–π —Ç—É–∫, —Å—Ç–∞–Ω–∏ —á–∞—Å—Ç –æ—Ç –ü.–ï.–î.–ê.–õ.
    </p>

    <!-- Platform Buttons -->
    <div class="flex justify-center gap-4 mt-2">
      <button class="px-4 py-2 rounded-xl bg-slate-800 border border-slate-700 text-slate-300 text-sm font-semibold flex items-center gap-2 opacity-70 cursor-not-allowed">
        ü§ñ Android <span class="text-[10px] text-slate-500">(–°–∫–æ—Ä–æ)</span>
      </button>
      <button class="px-4 py-2 rounded-xl bg-slate-800 border border-slate-700 text-slate-300 text-sm font-semibold flex items-center gap-2 opacity-70 cursor-not-allowed">
        üçé iOS <span class="text-[10px] text-slate-500">(–°–∫–æ—Ä–æ)</span>
      </button>
    </div>

    <!-- Back + Search -->
    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
      <button
        id="backBtn"
        class="hidden px-4 py-2 rounded-xl bg-slate-900/80 border border-slate-700 text-slate-300 text-sm font-medium hover:bg-slate-800 hover:text-white hover:border-red-500/60 transition-all flex items-center gap-2"
        type="button"
      >
        <span class="text-lg">&larr;</span>
        <span>–ù–∞–∑–∞–¥</span>
      </button>

      <div class="flex-1">
        <div class="relative">
          <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm">
            üîç
          </span>
          <input
            id="searchInput"
            type="text"
            placeholder="–¢—ä—Ä—Å–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω (CB, E) –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä (7072TH)..."
            class="w-full pl-9 pr-4 py-2.5 rounded-2xl bg-slate-900/80 border border-slate-700 text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-red-500/70 focus:border-red-500/70 transition-all"
          />
        </div>
        <p class="mt-1 text-[9px] text-slate-500">
          –†–∞–∑–≥–ª–µ–¥–∞–π –¥–æ–∫–ª–∞–¥–∏—Ç–µ –ø–æ —Ä–µ–≥–∏–æ–Ω, —Å–ª–µ–¥ —Ç–æ–≤–∞ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä. –ù–∞—Ç–∏—Å–Ω–∏ –≤—ä—Ä—Ö—É –µ–ª–µ–º–µ–Ω—Ç, –∑–∞ –¥–∞ –æ—Ç–≤–æ—Ä–∏—à –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–∞—Ç–∞.
        </p>
      </div>
    </div>

    <!-- Context -->
    <section class="text-[10px] sm:text-xs text-slate-500 leading-relaxed">
      <p>
        –ü.–ï.–î.–ê.–õ.—à –µ –ø—Ä–æ—Å—Ç –ø—É–±–ª–∏—á–µ–Ω –¥–Ω–µ–≤–Ω–∏–∫. –ü–∞–ø–∫–∏—Ç–µ —Å–∞ –æ—Ä–≥–∞–Ω–∏–∑–∏—Ä–∞–Ω–∏ –∫–∞—Ç–æ:
        <span class="text-slate-300">&lt;–û–±–ª–∞—Å—Ç&gt;/&lt;–ù–æ–º–µ—Ä&gt;/—Å–Ω–∏–º–∫–∏ –∏–ª–∏ –≤–∏–¥–µ–æ</span>.
        –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ç–∞ –∏ –≤–∏–¥–µ–∞—Ç–∞ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç —Å–∞–º–æ –∫–∞—Ç–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–∞.
      </p>
    </section>

    <!-- Dynamic Grid -->
    <main>
      <div
        id="folderGrid"
        class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4"
      >
        <!-- Populated by JavaScript -->
      </div>
    </main>
  </div>

  <!-- Fullscreen Viewer -->
  <div
    id="viewerModal"
    class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 hidden"
  >
    <div class="relative max-w-5xl max-h-[90vh] w-full flex items-center justify-center px-4">
      <button
        id="viewerClose"
        type="button"
        class="absolute top-4 right-6 bg-slate-900/90 border border-slate-600 text-slate-100 rounded-full px-3 py-1.5 text-xs font-semibold shadow-lg hover:bg-red-600 hover:border-red-400 hover:text-white transition-all"
      >
        ‚úï –ó–∞—Ç–≤–æ—Ä–∏
      </button>
      <div
        id="viewerContent"
        class="w-full h-full flex items-center justify-center"
      ></div>
    </div>
  </div>

  <script>
    // --- State ---
    let dataCache = null;         // { REGION: { PLATE: [files...] } }
    let basePedaliPath = 'pedali';
    let currentView = 'regions';  // 'regions' | 'subfolders' | 'files'
    let currentRegion = null;
    let currentSubfolder = null;

    const folderGrid = document.getElementById('folderGrid');
    const backBtn = document.getElementById('backBtn');
    const searchInput = document.getElementById('searchInput');
    const viewerModal = document.getElementById('viewerModal');
    const viewerClose = document.getElementById('viewerClose');
    const viewerContent = document.getElementById('viewerContent');

    // --- Data Loading ---
    async function loadData() {
      async function tryFetch(url) {
        try {
          const res = await fetch(url);
          if (!res.ok) return null;
          return await res.json();
        } catch {
          return null;
        }
      }

      // Try local /PEDAL/pedali first, then root /pedali
      let data = await tryFetch('pedali/index.json');
      if (data && data.folders) {
        basePedaliPath = 'pedali';
      } else {
        data = await tryFetch('/pedali/index.json');
        if (data && data.folders) {
          basePedaliPath = '/pedali';
        }
      }

      if (!data || !data.folders || !Object.keys(data.folders).length) {
        folderGrid.innerHTML =
          '<p class="col-span-full text-center text-slate-500 text-sm py-8 border border-dashed border-slate-700/70 rounded-2xl bg-slate-900/40">–ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥–∏ —Å–ø–∏—Å—ä–∫—ä—Ç —Å –ø–∞–ø–∫–∏.<br/><span class="text-[10px] text-slate-600">–°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–∑ –ª–æ–∫–∞–ª–µ–Ω —É–µ–± —Å—ä—Ä–≤—ä—Ä –∏ —Å–µ —É–≤–µ—Ä–µ—Ç–µ, —á–µ <span class="text-red-400">pedali/index.json</span> —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ —Å –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.</span></p>';
        return;
      }

      dataCache = data.folders;
      renderRegions();
    }

    // --- Helpers ---
    function setBackVisibility() {
      if (currentView === 'regions') {
        backBtn.classList.add('hidden');
      } else {
        backBtn.classList.remove('hidden');
      }
    }

    function clearGrid() {
      folderGrid.innerHTML = '';
    }

    function createCard(baseClasses) {
      const div = document.createElement('div');
      div.className =
        baseClasses ||
        'group relative flex flex-col gap-1 p-3 sm:p-4 rounded-2xl bg-slate-900/85 border border-slate-800 hover:border-red-500/70 hover:bg-slate-900 shadow-sm hover:shadow-red-900/30 transition-all cursor-pointer overflow-hidden';
      return div;
    }

    // --- Render: Regions ---
    function renderRegions(filter = '') {
      if (!dataCache) return;
      currentView = 'regions';
      currentRegion = null;
      currentSubfolder = null;
      setBackVisibility();
      clearGrid();

      let regions = Object.keys(dataCache);
      if (filter) {
        const f = filter.toLowerCase();
        regions = regions.filter((r) => r.toLowerCase().includes(f));
      }
      regions.sort();

      if (!regions.length) {
        folderGrid.innerHTML =
          '<p class="col-span-full text-center text-slate-500 text-xs py-6 border border-dashed border-slate-700/70 rounded-2xl bg-slate-900/40">–ù—è–º–∞ —Ä–µ–≥–∏–æ–Ω–∏, –æ—Ç–≥–æ–≤–∞—Ä—è—â–∏ –Ω–∞ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ.</p>';
        return;
      }

      regions.forEach((region) => {
        const card = createCard();
        const label = document.createElement('div');
        label.className =
          'text-[9px] uppercase tracking-[0.16em] text-slate-500';
        label.textContent = '–†–µ–≥–∏–æ–Ω';

        const code = document.createElement('div');
        code.className =
          'text-xl sm:text-2xl font-extrabold text-red-400 leading-none';
        code.textContent = region;

        const hint = document.createElement('div');
        hint.className = 'mt-1 text-[9px] text-slate-500';
        hint.textContent = '–ù–∞—Ç–∏—Å–Ω–∏, –∑–∞ –¥–∞ –≤–∏–¥–∏—à –¥–æ–∫–ª–∞–¥–≤–∞–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä–∞';

        card.appendChild(label);
        card.appendChild(code);
        card.appendChild(hint);

        card.addEventListener('click', () => renderSubfolders(region));
        folderGrid.appendChild(card);
      });
    }

    // --- Render: Subfolders (plates) ---
    function renderSubfolders(region, filter = '') {
      if (!dataCache || !dataCache[region]) {
        renderRegions();
        return;
      }

      currentView = 'subfolders';
      currentRegion = region;
      currentSubfolder = null;
      setBackVisibility();
      clearGrid();

      let subfolders = Object.keys(dataCache[region]);
      if (filter) {
        const f = filter.toLowerCase();
        subfolders = subfolders.filter((s) => s.toLowerCase().includes(f));
      }
      subfolders.sort();

      if (!subfolders.length) {
        folderGrid.innerHTML =
          '<p class="col-span-full text-center text-slate-500 text-xs py-6 border border-dashed border-slate-700/70 rounded-2xl bg-slate-900/40">–ù—è–º–∞ –Ω–æ–º–µ—Ä–∞, –æ—Ç–≥–æ–≤–∞—Ä—è—â–∏ –Ω–∞ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ –≤ —Ç–æ–∑–∏ —Ä–µ–≥–∏–æ–Ω.</p>';
        return;
      }

      subfolders.forEach((sub) => {
        const files = dataCache[region][sub] || [];
        const card = createCard();

        const plate = document.createElement('div');
        plate.className =
          'inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-slate-950/95 border border-slate-700 text-red-400 text-xs font-semibold';
        plate.innerHTML =
          '<span class="text-[9px] text-slate-500">–ù–æ–º–µ—Ä</span> ' +
          sub;

        const count = document.createElement('div');
        count.className = 'text-[9px] text-slate-500';
        count.textContent =
          (files.length || 0) === 1
            ? '1 –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–æ'
            : files.length + ' –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–∞';

        const hint = document.createElement('div');
        hint.className = 'mt-auto text-[9px] text-red-400/80';
        hint.textContent = '–û—Ç–≤–æ—Ä–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–∞—Ç–∞';

        card.appendChild(plate);
        card.appendChild(count);
        card.appendChild(hint);

        card.addEventListener('click', () => renderFiles(region, sub));
        folderGrid.appendChild(card);
      });
    }

    // --- Render: Files (evidence) ---
    function renderFiles(region, sub) {
      const files = dataCache?.[region]?.[sub] || [];
      currentView = 'files';
      currentRegion = region;
      currentSubfolder = sub;
      setBackVisibility();
      clearGrid();

      if (!files.length) {
        folderGrid.innerHTML =
          '<p class="col-span-full text-center text-slate-500 text-xs py-6 border border-dashed border-slate-700/70 rounded-2xl bg-slate-900/40">–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ –∑–∞ —Ç–æ–∑–∏ –Ω–æ–º–µ—Ä.</p>';
        return;
      }

      files.forEach((file) => {
        const ext = file.split('.').pop().toLowerCase();
        const src = `${basePedaliPath}/${region}/${sub}/${file}`;

        const card = document.createElement('div');
        card.className =
          'relative group rounded-2xl bg-slate-900/95 border border-slate-800 overflow-hidden shadow-sm hover:shadow-red-900/40 transition-all cursor-pointer';

        const badge = document.createElement('div');
        badge.className =
          'absolute top-2 left-2 px-2 py-0.5 rounded-full bg-black/75 text-[9px] text-red-300 border border-red-500/60 flex items-center gap-1';
        badge.innerHTML =
          '<span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span> –î–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–æ';
        card.appendChild(badge);

        if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'heic'].includes(ext)) {
          const img = document.createElement('img');
          img.src = src;
          img.alt = file;
          img.loading = 'lazy';
          img.className =
            'w-full h-40 sm:h-44 object-cover transform group-hover:scale-105 transition-all duration-300';
          card.appendChild(img);
          card.addEventListener('click', () => openViewer('image', src));
        } else if (['mp4', 'mov', 'webm'].includes(ext)) {
          const video = document.createElement('video');
          video.src = src;
          video.muted = true;
          video.loop = true;
          video.playsInline = true;
          video.className =
            'w-full h-40 sm:h-44 object-cover opacity-90 group-hover:opacity-100 group-hover:scale-105 transition-all duration-300';
          video.addEventListener('mouseenter', () => video.play());
          video.addEventListener('mouseleave', () => video.pause());
          card.appendChild(video);

          const playIcon = document.createElement('div');
          playIcon.className =
            'absolute inset-0 flex items-center justify-center pointer-events-none';
          playIcon.innerHTML =
            '<div class="w-9 h-9 rounded-full bg-black/65 border border-red-400 flex items-center justify-center text-red-400 text-xs font-bold group-hover:bg-red-600 group-hover:text-white group-hover:border-white transition-all">&#9658;</div>';
          card.appendChild(playIcon);

          card.addEventListener('click', () => openViewer('video', src));
        } else {
          const p = document.createElement('p');
          p.textContent = file;
          p.className =
            'p-4 text-[10px] text-slate-300 break-all bg-slate-950/90';
          card.appendChild(p);
          card.addEventListener('click', () => openViewer('file', src));
        }

        // --- Add date under thumbnail ---
        const dateLine = document.createElement('p');
        dateLine.className = 'text-xs text-slate-500 mt-1 text-center';
        dateLine.textContent = 'üìÖ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ...';
        card.appendChild(dateLine);

        // Delay HEAD fetch to avoid blocking index.json loading
        setTimeout(() => {
          fetch(src, { method: 'HEAD' })
            .then(res => {
              const lastMod = res.headers.get('Last-Modified');
              if (lastMod) {
                const d = new Date(lastMod);
                const formatted = `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
                dateLine.textContent = `üìÖ ${formatted}`;
              } else {
                dateLine.textContent = 'üìÖ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –¥–∞—Ç–∞';
              }
            })
            .catch(() => {
              dateLine.textContent = 'üìÖ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –¥–∞—Ç–∞';
            });
        }, 200);

        folderGrid.appendChild(card);
      });
    }

    // --- Viewer ---
    function openViewer(type, src) {
      viewerContent.innerHTML = '';

      if (type === 'image') {
        const img = document.createElement('img');
        img.src = src;
        img.className =
          'max-w-full max-h-[90vh] object-contain rounded-2xl shadow-2xl border border-slate-700';
        viewerContent.appendChild(img);
      } else if (type === 'video') {
        const video = document.createElement('video');
        video.src = src;
        video.controls = true;
        video.autoplay = true;
        video.className =
          'max-w-full max-h-[90vh] object-contain rounded-2xl shadow-2xl border border-slate-700';
        viewerContent.appendChild(video);
      } else {
        const link = document.createElement('a');
        link.href = src;
        link.target = '_blank';
        link.className =
          'px-4 py-2 rounded-xl bg-slate-900 text-slate-100 border border-slate-600 text-sm';
        link.textContent = '–û—Ç–≤–æ—Ä–∏ —Ñ–∞–π–ª';
        viewerContent.appendChild(link);
      }

      viewerModal.classList.remove('hidden');
    }

    function closeViewer() {
      viewerContent.innerHTML = '';
      viewerModal.classList.add('hidden');
    }

    // --- Events ---
    backBtn.addEventListener('click', () => {
      if (currentView === 'files') {
        renderSubfolders(currentRegion);
      } else if (currentView === 'subfolders') {
        renderRegions();
      }
    });

    viewerClose.addEventListener('click', closeViewer);

    viewerModal.addEventListener('click', (e) => {
      if (e.target === viewerModal) {
        closeViewer();
      }
    });

    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.trim().toLowerCase();

      if (!dataCache) return;

      if (currentView === 'regions') {
        renderRegions(term);
      } else if (currentView === 'subfolders' && currentRegion) {
        renderSubfolders(currentRegion, term);
      } else if (currentView === 'files') {
        // In files view we filter visible cards client-side
        Array.from(folderGrid.children).forEach((card) => {
          const text = card.textContent.toLowerCase();
          card.style.display = term === '' || text.includes(term) ? '' : 'none';
        });
      }
    });

    // --- Init ---
    loadData();
  </script>
</body>
</html>